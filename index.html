<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inwood Logistics - Professional Hub Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            color: #1a1a1a;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 300;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .tabs {
            background: white;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
            display: flex;
            gap: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background: #f8f9fa;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .stat-card h3 {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .stat-card .value {
            font-size: 28px;
            font-weight: bold;
            color: #1a1a1a;
        }
        
        .stat-card .change {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .stat-card.green .value {
            color: #27ae60;
        }
        
        .stat-card.blue .value {
            color: #3498db;
        }
        
        .stat-card.orange .value {
            color: #e67e22;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .card h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #e9ecef;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #f1f3f4;
            font-size: 14px;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: 500;
            color: #495057;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .period-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .period-btn {
            padding: 8px 16px;
            border: 1px solid #dee2e6;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .period-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ“¦ Inwood Logistics Hub Management</h1>
        <p>Professional Amazon Delivery Tracking & Financial Analytics</p>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="tab" onclick="switchTab('financial')">Financial Overview</button>
            <button class="tab" onclick="switchTab('deliveries')">Add Entry</button>
            <button class="tab" onclick="switchTab('payouts')">Weekly Payouts</button>
            <button class="tab" onclick="switchTab('history')">Historical Data</button>
            <button class="tab" onclick="switchTab('analytics')">Analytics</button>
            <button class="tab" onclick="switchTab('settings')">Settings</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Today's Profit</h3>
                    <div class="value">$0.00</div>
                    <div class="change">Friday, August 16, 2025</div>
                </div>
                <div class="stat-card green">
                    <h3>Week-to-Date</h3>
                    <div class="value">$440.54</div>
                    <div class="change">Aug 11-17 (incl. HCP)</div>
                </div>
                <div class="stat-card blue">
                    <h3>Month-to-Date</h3>
                    <div class="value">$1,343.27</div>
                    <div class="change">August 2025 (incl. HCP)</div>
                </div>
                <div class="stat-card orange">
                    <h3>Year-to-Date</h3>
                    <div class="value">$4,683.50</div>
                    <div class="change">Since Jan 2025 (incl. HCP)</div>
                </div>
            </div>

            <div class="card">
                <h2>Current Week Summary (Aug 11-17, 2025)</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Business</th>
                            <th>Packages</th>
                            <th>Gross Revenue</th>
                            <th>Driver Costs</th>
                            <th>Net Profit</th>
                            <th>Margin</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Senor Bigote</strong> <span class="badge badge-info">HCP</span></td>
                            <td>200</td>
                            <td>$337.50</td>
                            <td>$200.00</td>
                            <td style="color: #27ae60;">$137.50</td>
                            <td><span class="badge badge-success">40.7%</span></td>
                        </tr>
                        <tr>
                            <td><strong>809 Restaurant</strong></td>
                            <td>200</td>
                            <td>$337.50</td>
                            <td>$200.00</td>
                            <td style="color: #27ae60;">$137.50</td>
                            <td><span class="badge badge-success">40.7%</span></td>
                        </tr>
                        <tr>
                            <td><strong>Cana Stays</strong></td>
                            <td>191</td>
                            <td>$323.50</td>
                            <td>$191.00</td>
                            <td style="color: #27ae60;">$132.50</td>
                            <td><span class="badge badge-success">41.0%</span></td>
                        </tr>
                        <tr style="background: #f8f9fa; font-weight: bold;">
                            <td>SUBTOTAL</td>
                            <td>591</td>
                            <td>$998.50</td>
                            <td>$591.00</td>
                            <td style="color: #27ae60;">$407.50</td>
                            <td><span class="badge badge-info">40.8%</span></td>
                        </tr>
                        <tr style="background: #e8f5e9;">
                            <td colspan="4"><strong>HCP Revenue (Senor Bigote)</strong></td>
                            <td style="color: #27ae60;">$33.04</td>
                            <td><span class="badge badge-info">Daily</span></td>
                        </tr>
                        <tr style="background: #e3f2fd; font-weight: bold;">
                            <td colspan="4">TOTAL WEEK PROFIT</td>
                            <td style="color: #27ae60; font-size: 18px;">$440.54</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>Driver Payments - Current Week</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Driver</th>
                            <th>Breakdown</th>
                            <th>Total Packages</th>
                            <th>Amount Owed</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Gabriel</strong></td>
                            <td>Senor Bigote: 162</td>
                            <td>162</td>
                            <td>$162.00</td>
                            <td><span class="badge badge-warning">Pending</span></td>
                        </tr>
                        <tr>
                            <td><strong>Rafa JR</strong></td>
                            <td>Cana Stays: 153</td>
                            <td>153</td>
                            <td>$153.00</td>
                            <td><span class="badge badge-warning">Pending</span></td>
                        </tr>
                        <tr>
                            <td><strong>Jeuris</strong></td>
                            <td>809: 200, SB: 38, CS: 38</td>
                            <td>276</td>
                            <td>$276.00</td>
                            <td><span class="badge badge-success">Paid (8/14)</span></td>
                        </tr>
                        <tr style="background: #f8f9fa; font-weight: bold;">
                            <td>TOTAL</td>
                            <td></td>
                            <td>591</td>
                            <td>$591.00</td>
                            <td>Outstanding: $315.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Financial Overview Tab -->
        <div id="financial" class="tab-content">
            <div class="period-selector">
                <button class="period-btn active" onclick="setPeriod('wtd')">Week-to-Date</button>
                <button class="period-btn" onclick="setPeriod('mtd')">Month-to-Date</button>
                <button class="period-btn" onclick="setPeriod('ytd')">Year-to-Date</button>
                <button class="period-btn" onclick="setPeriod('all')">All Time</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Gross Revenue</h3>
                    <div class="value" id="grossRevenue">$941.00</div>
                    <div class="change">From Amazon</div>
                </div>
                <div class="stat-card">
                    <h3>Total Costs</h3>
                    <div class="value" id="totalCosts">$553.00</div>
                    <div class="change">Driver payments</div>
                </div>
                <div class="stat-card green">
                    <h3>Net Profit</h3>
                    <div class="value" id="netProfit">$388.00</div>
                    <div class="change">After costs</div>
                </div>
                <div class="stat-card blue">
                    <h3>Profit Margin</h3>
                    <div class="value" id="profitMargin">41.2%</div>
                    <div class="change">Efficiency rate</div>
                </div>
            </div>

            <div class="summary-grid">
                <div class="card">
                    <h2>Business Performance - WTD</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Business</th>
                                <th>Gross</th>
                                <th>Net</th>
                                <th>Margin</th>
                            </tr>
                        </thead>
                        <tbody id="businessPerformance">
                            <tr>
                                <td>Senor Bigote</td>
                                <td>$337.50</td>
                                <td>$137.50</td>
                                <td>40.7%</td>
                            </tr>
                            <tr>
                                <td>809 Restaurant</td>
                                <td>$337.50</td>
                                <td>$137.50</td>
                                <td>40.7%</td>
                            </tr>
                            <tr>
                                <td>Cana Stays</td>
                                <td>$266.00</td>
                                <td>$113.00</td>
                                <td>42.5%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <h2>Driver Earnings - WTD</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Driver</th>
                                <th>Packages</th>
                                <th>Earnings</th>
                                <th>Avg/Day</th>
                            </tr>
                        </thead>
                        <tbody id="driverEarnings">
                            <tr>
                                <td>Gabriel</td>
                                <td>162</td>
                                <td>$162.00</td>
                                <td>$40.50</td>
                            </tr>
                            <tr>
                                <td>Rafa JR</td>
                                <td>153</td>
                                <td>$153.00</td>
                                <td>$38.25</td>
                            </tr>
                            <tr>
                                <td>Jeuris</td>
                                <td>276</td>
                                <td>$276.00</td>
                                <td>$55.20</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h2>Monthly Trend</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Packages</th>
                            <th>Gross Revenue</th>
                            <th>Net Profit</th>
                            <th>Margin</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>July 2025</td>
                            <td>921</td>
                            <td>$1,567.50</td>
                            <td>$646.50</td>
                            <td>41.2%</td>
                        </tr>
                        <tr>
                            <td>August 2025 (MTD)</td>
                            <td>553</td>
                            <td>$941.00</td>
                            <td>$388.00</td>
                            <td>41.2%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Add Delivery Tab -->
        <div id="deliveries" class="tab-content">
            <div class="card">
                <h2>Add New Delivery Entry</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="deliveryDate" value="2025-08-16">
                    </div>
                    <div class="form-group">
                        <label>Driver</label>
                        <select id="deliveryDriver">
                            <option value="">Select Driver</option>
                            <!-- Populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Business</label>
                        <select id="deliveryBusiness">
                            <option value="">Select Business</option>
                            <!-- Populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Packages</label>
                        <input type="number" id="deliveryPackages" min="0" placeholder="0">
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;">
                    <strong>Instant Calculation:</strong>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 10px;">
                        <div>
                            <div style="color: #666; font-size: 12px;">Amazon Pays You</div>
                            <div style="font-size: 20px; font-weight: bold;">$<span id="previewAmazon">0.00</span></div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 12px;">You Pay Driver</div>
                            <div style="font-size: 20px; font-weight: bold;">$<span id="previewDriver">0.00</span></div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 12px;">Your Profit</div>
                            <div style="font-size: 20px; font-weight: bold; color: #27ae60;">$<span id="previewProfit">0.00</span></div>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="addDelivery()">Add Delivery</button>
                <button class="btn btn-secondary" onclick="clearForm()">Clear Form</button>
            </div>

            <div class="card">
                <h2>Recent Entries</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Driver</th>
                            <th>Business</th>
                            <th>Packages</th>
                            <th>Revenue</th>
                            <th>Cost</th>
                            <th>Profit</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="recentEntries">
                        <!-- Will be populated -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Weekly Payouts Tab -->
        <div id="payouts" class="tab-content">
            <div class="card">
                <h2>Weekly Payouts Management</h2>
                
                <div class="form-group" style="max-width: 300px;">
                    <label>Select Week</label>
                    <input type="week" id="payoutWeek" value="2025-W33" onchange="loadWeek()">
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Driver</th>
                            <th>Business</th>
                            <th>Packages</th>
                            <th>Amount</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="payoutBody">
                        <!-- Will be populated -->
                    </tbody>
                </table>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">Week Totals</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div>
                            <strong>Gabriel:</strong> $<span id="gabrielTotal">0.00</span>
                        </div>
                        <div>
                            <strong>Rafa JR:</strong> $<span id="rafaTotal">0.00</span>
                        </div>
                        <div>
                            <strong>Jeuris:</strong> $<span id="jeurisTotal">0.00</span>
                        </div>
                        <div>
                            <strong>TOTAL:</strong> $<span id="weekTotal">0.00</span>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-success" onclick="markAllPaid()">Mark All Paid</button>
                        <button class="btn btn-primary" onclick="exportWeek()">Export CSV</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Historical Data Tab -->
        <div id="history" class="tab-content">
            <div class="card">
                <h2>Historical Data Import</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Month</label>
                        <input type="month" id="historyMonth">
                    </div>
                    <div class="form-group">
                        <label>Total Gross Revenue</label>
                        <input type="number" id="historyGross" placeholder="0.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Driver Cost %</label>
                        <input type="number" id="historyCostPercent" placeholder="60" value="60">
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="addHistorical()">Add Historical Month</button>
            </div>

            <div class="card">
                <h2>All Historical Data</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Period</th>
                            <th>Packages</th>
                            <th>Gross Revenue</th>
                            <th>Driver Costs</th>
                            <th>Net Profit</th>
                            <th>Type</th>
                        </tr>
                    </thead>
                    <tbody id="historyBody">
                        <tr>
                            <td>Week Aug 11-17, 2025</td>
                            <td>591</td>
                            <td>$998.50</td>
                            <td>$591.00</td>
                            <td>$407.50</td>
                            <td><span class="badge badge-success">Current</span></td>
                        </tr>
                        <tr>
                            <td>Week Aug 4-10, 2025</td>
                            <td>836</td>
                            <td>$1,418.00</td>
                            <td>$836.00</td>
                            <td>$582.00</td>
                            <td><span class="badge badge-success">Actual</span></td>
                        </tr>
                        <tr>
                            <td>Week July 28-Aug 3, 2025</td>
                            <td>794</td>
                            <td>$1,348.00</td>
                            <td>$794.00</td>
                            <td>$554.00</td>
                            <td><span class="badge badge-success">Actual</span></td>
                        </tr>
                        <tr>
                            <td>Week July 21-27, 2025</td>
                            <td>477</td>
                            <td>$812.00</td>
                            <td>$477.00</td>
                            <td>$335.00</td>
                            <td><span class="badge badge-success">Actual</span></td>
                        </tr>
                        <tr>
                            <td>June 2025</td>
                            <td>~850</td>
                            <td>$1,445.00*</td>
                            <td>$867.00*</td>
                            <td>$578.00*</td>
                            <td><span class="badge badge-info">Estimated</span></td>
                        </tr>
                        <tr>
                            <td>May 2025</td>
                            <td>~780</td>
                            <td>$1,320.00*</td>
                            <td>$792.00*</td>
                            <td>$528.00*</td>
                            <td><span class="badge badge-info">Estimated</span></td>
                        </tr>
                    </tbody>
                </table>
                <p style="margin-top: 10px; color: #666; font-size: 12px;">* Estimated values based on gross revenue and assumed driver cost percentage</p>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="card">
                <h2>Business Analytics</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Best Performing Business</h3>
                        <div class="value" style="font-size: 20px;">Cana Stays</div>
                        <div class="change">42.5% margin</div>
                    </div>
                    <div class="stat-card">
                        <h3>Top Driver (Packages)</h3>
                        <div class="value" style="font-size: 20px;">Jeuris</div>
                        <div class="change">276 packages this week</div>
                    </div>
                    <div class="stat-card">
                        <h3>Average Daily Profit</h3>
                        <div class="value">$81.50</div>
                        <div class="change">Based on WTD</div>
                    </div>
                    <div class="stat-card">
                        <h3>Projected Monthly</h3>
                        <div class="value">$1,745.00</div>
                        <div class="change">At current rate</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Payment Validation Tool</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Start Date</label>
                        <input type="date" id="validStart">
                    </div>
                    <div class="form-group">
                        <label>End Date</label>
                        <input type="date" id="validEnd">
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button class="btn btn-primary" onclick="validatePayment()">Validate Amazon Payment</button>
                    </div>
                </div>
                
                <div id="validationResult" style="display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <!-- Results will appear here -->
                </div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="card">
                <h2>Manage Drivers</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 20px;">
                    <div id="driversList">
                        <!-- Will be populated with current drivers -->
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Add New Driver</label>
                        <input type="text" id="newDriverName" placeholder="Enter driver name">
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button class="btn btn-primary" onclick="addDriver()">Add Driver</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Manage Businesses</h2>
                
                <table id="businessManagementTable">
                    <thead>
                        <tr>
                            <th>Business Name</th>
                            <th>HCP Status</th>
                            <th>Weekly HCP Payment</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="businessList">
                        <!-- Will be populated with current businesses -->
                    </tbody>
                </table>
                
                <div class="form-row" style="margin-top: 20px;">
                    <div class="form-group">
                        <label>Add New Business</label>
                        <input type="text" id="newBusinessName" placeholder="Enter business name">
                    </div>
                    <div class="form-group">
                        <label>Make it HCP?</label>
                        <select id="newBusinessHCP">
                            <option value="no">No</option>
                            <option value="yes">Yes - $230.77/week</option>
                        </select>
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button class="btn btn-primary" onclick="addBusiness()">Add Business</button>
                    </div>
                </div>
                
                <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <small><strong>Note:</strong> When making a business HCP, you can set a custom weekly amount or use the default $230.77.</small>
                </div>
            </div>
            
            <div class="card">
                <h2>HCP Revenue Summary</h2>
                <div id="hcpSummary">
                    <!-- Will show current HCP businesses and revenue -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Complete data structure with all historical data from tracking sheet
        let inwoodData = {
            drivers: ['Gabriel', 'Rafa JR', 'Jeuris'],
            
            businesses: [
                {name: 'Senor Bigote', isHCP: true, hcpWeekly: 230.77},
                {name: '809 Restaurant', isHCP: false, hcpWeekly: 0},
                {name: 'Cana Stays', isHCP: false, hcpWeekly: 0}
            ],
            
            deliveries: [
                // Week of July 21-27, 2025
                {date: '2025-07-21', driver: 'Gabriel', business: '809 Restaurant', packages: 40},
                {date: '2025-07-21', driver: 'Gabriel', business: 'Senor Bigote', packages: 39},
                {date: '2025-07-22', driver: 'Gabriel', business: '809 Restaurant', packages: 41},
                {date: '2025-07-22', driver: 'Gabriel', business: 'Senor Bigote', packages: 41},
                {date: '2025-07-21', driver: 'Rafa JR', business: 'Cana Stays', packages: 42},
                {date: '2025-07-22', driver: 'Rafa JR', business: 'Cana Stays', packages: 42},
                {date: '2025-07-23', driver: 'Rafa JR', business: 'Cana Stays', packages: 42},
                {date: '2025-07-24', driver: 'Rafa JR', business: 'Cana Stays', packages: 40},
                {date: '2025-07-25', driver: 'Rafa JR', business: 'Cana Stays', packages: 38},
                {date: '2025-07-25', driver: 'Jeuris', business: '809 Restaurant', packages: 36},
                {date: '2025-07-25', driver: 'Jeuris', business: 'Senor Bigote', packages: 39},
                {date: '2025-07-27', driver: 'Rafa JR', business: 'Cana Stays', packages: 37},
                
                // Week of July 28 - Aug 3, 2025
                {date: '2025-07-28', driver: 'Rafa JR', business: 'Cana Stays', packages: 38},
                {date: '2025-07-29', driver: 'Rafa JR', business: 'Cana Stays', packages: 40},
                {date: '2025-07-30', driver: 'Rafa JR', business: 'Cana Stays', packages: 38},
                {date: '2025-07-31', driver: 'Rafa JR', business: 'Cana Stays', packages: 30},
                {date: '2025-08-01', driver: 'Rafa JR', business: 'Cana Stays', packages: 40},
                {date: '2025-08-02', driver: 'Rafa JR', business: 'Senor Bigote', packages: 38},
                {date: '2025-08-02', driver: 'Rafa JR', business: '809 Restaurant', packages: 40},
                {date: '2025-08-02', driver: 'Rafa JR', business: 'Cana Stays', packages: 36},
                // Jeuris worked Monday-Friday both businesses
                {date: '2025-07-28', driver: 'Jeuris', business: '809 Restaurant', packages: 38},
                {date: '2025-07-28', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-07-29', driver: 'Jeuris', business: '809 Restaurant', packages: 38},
                {date: '2025-07-29', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-07-30', driver: 'Jeuris', business: '809 Restaurant', packages: 38},
                {date: '2025-07-30', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-07-31', driver: 'Jeuris', business: '809 Restaurant', packages: 38},
                {date: '2025-07-31', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-08-01', driver: 'Jeuris', business: '809 Restaurant', packages: 38},
                {date: '2025-08-01', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-08-03', driver: 'Jeuris', business: '809 Restaurant', packages: 38},
                {date: '2025-08-03', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-08-03', driver: 'Jeuris', business: 'Cana Stays', packages: 38},
                
                // Week of Aug 4-10, 2025
                {date: '2025-08-04', driver: 'Rafa JR', business: 'Cana Stays', packages: 38},
                {date: '2025-08-05', driver: 'Rafa JR', business: 'Cana Stays', packages: 39},
                {date: '2025-08-06', driver: 'Rafa JR', business: 'Cana Stays', packages: 40},
                {date: '2025-08-07', driver: 'Rafa JR', business: 'Cana Stays', packages: 37},
                {date: '2025-08-08', driver: 'Rafa JR', business: 'Cana Stays', packages: 39},
                {date: '2025-08-09', driver: 'Rafa JR', business: 'Cana Stays', packages: 39},
                {date: '2025-08-09', driver: 'Gabriel', business: 'Senor Bigote', packages: 42},
                {date: '2025-08-10', driver: 'Gabriel', business: 'Cana Stays', packages: 41},
                {date: '2025-08-10', driver: 'Gabriel', business: 'Senor Bigote', packages: 43},
                {date: '2025-08-04', driver: 'Jeuris', business: '809 Restaurant', packages: 41},
                {date: '2025-08-04', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-08-05', driver: 'Jeuris', business: '809 Restaurant', packages: 41},
                {date: '2025-08-05', driver: 'Jeuris', business: 'Senor Bigote', packages: 40},
                {date: '2025-08-06', driver: 'Jeuris', business: '809 Restaurant', packages: 40},
                {date: '2025-08-06', driver: 'Jeuris', business: 'Senor Bigote', packages: 40},
                {date: '2025-08-07', driver: 'Jeuris', business: '809 Restaurant', packages: 36},
                {date: '2025-08-07', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-08-08', driver: 'Jeuris', business: '809 Restaurant', packages: 40},
                {date: '2025-08-08', driver: 'Jeuris', business: 'Senor Bigote', packages: 40},
                {date: '2025-08-09', driver: 'Jeuris', business: '809 Restaurant', packages: 42},
                {date: '2025-08-10', driver: 'Jeuris', business: '809 Restaurant', packages: 42},
                
                // Week of Aug 11-17, 2025 - CURRENT WEEK
                {date: '2025-08-11', driver: 'Gabriel', business: 'Senor Bigote', packages: 41},
                {date: '2025-08-12', driver: 'Gabriel', business: 'Senor Bigote', packages: 42},
                {date: '2025-08-13', driver: 'Gabriel', business: 'Senor Bigote', packages: 41},
                {date: '2025-08-14', driver: 'Gabriel', business: 'Senor Bigote', packages: 38},
                {date: '2025-08-11', driver: 'Rafa JR', business: 'Cana Stays', packages: 38},
                {date: '2025-08-13', driver: 'Rafa JR', business: 'Cana Stays', packages: 40},
                {date: '2025-08-14', driver: 'Rafa JR', business: 'Cana Stays', packages: 37},
                {date: '2025-08-15', driver: 'Rafa JR', business: 'Cana Stays', packages: 38},
                {date: '2025-08-11', driver: 'Jeuris', business: '809 Restaurant', packages: 41},
                {date: '2025-08-12', driver: 'Jeuris', business: '809 Restaurant', packages: 40},
                {date: '2025-08-12', driver: 'Jeuris', business: 'Cana Stays', packages: 38},
                {date: '2025-08-13', driver: 'Jeuris', business: '809 Restaurant', packages: 41},
                {date: '2025-08-14', driver: 'Jeuris', business: '809 Restaurant', packages: 40},
                {date: '2025-08-15', driver: 'Jeuris', business: '809 Restaurant', packages: 38},
                {date: '2025-08-15', driver: 'Jeuris', business: 'Senor Bigote', packages: 38}
                // Rafa JR has Sat/Sun (Aug 16-17) for Cana Stays but amounts not specified yet
            ],
            
            historicalMonths: [
                {month: '2025-06', gross: 1445.00, driverCost: 867.00, net: 578.00, estimated: true},
                {month: '2025-05', gross: 1320.00, driverCost: 792.00, net: 528.00, estimated: true}
            ],
            
            payments: [
                // Week July 21-27: PAID
                {week: '2025-W30', driver: 'Gabriel', amount: 161, paid: true, date: '2025-07-29'},
                {week: '2025-W30', driver: 'Rafa JR', amount: 241, paid: true, date: '2025-07-29'},
                {week: '2025-W30', driver: 'Jeuris', amount: 75, paid: true, date: '2025-07-29'},
                
                // Week July 28-Aug 3: PAID
                {week: '2025-W31', driver: 'Rafa JR', amount: 300, paid: true, date: '2025-08-07'},
                {week: '2025-W31', driver: 'Jeuris', amount: 494, paid: true, date: '2025-08-07'},
                
                // Week Aug 4-10: PAID
                {week: '2025-W32', driver: 'Gabriel', amount: 126, paid: true, date: '2025-08-11'},
                {week: '2025-W32', driver: 'Rafa JR', amount: 232, paid: true, date: '2025-08-11'},
                {week: '2025-W32', driver: 'Jeuris', amount: 478, paid: true, date: '2025-08-11'},
                
                // Week Aug 11-17: CURRENT WEEK
                {week: '2025-W33', driver: 'Jeuris', amount: 276, paid: true, date: '2025-08-14'} // Prepaid
                // Gabriel and Rafa JR still pending for current week
            ]
        };

        // Calculate functions
        function calculateAmazonPay(packages) {
            if (packages <= 25) {
                return packages * 2.00;
            } else {
                return (25 * 2.00) + ((packages - 25) * 1.50);
            }
        }

        function calculateDriverPay(packages) {
            return packages * 1.00;
        }

        // Switch tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'deliveries') {
                loadRecentEntries();
                updateDeliveryDropdowns();
            } else if (tabName === 'payouts') {
                loadWeek();
            } else if (tabName === 'settings') {
                loadSettings();
            }
        }
        
        // Update delivery dropdowns with current drivers and businesses
        function updateDeliveryDropdowns() {
            // Update driver dropdown
            const driverSelect = document.getElementById('deliveryDriver');
            driverSelect.innerHTML = '<option value="">Select Driver</option>' +
                inwoodData.drivers.map(driver => 
                    `<option value="${driver}">${driver}</option>`
                ).join('');
            
            // Update business dropdown
            const businessSelect = document.getElementById('deliveryBusiness');
            businessSelect.innerHTML = '<option value="">Select Business</option>' +
                inwoodData.businesses.map(business => 
                    `<option value="${business.name}">${business.name}${business.isHCP ? ' (HCP)' : ''}</option>`
                ).join('');
        }
        
        // Load settings page
        function loadSettings() {
            // Load drivers list
            const driversList = document.getElementById('driversList');
            driversList.innerHTML = inwoodData.drivers.map(driver => `
                <div style="padding: 10px; background: #f8f9fa; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
                    <span>${driver}</span>
                    <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="removeDriver('${driver}')">Remove</button>
                </div>
            `).join('');
            
            // Load businesses list
            const businessList = document.getElementById('businessList');
            businessList.innerHTML = inwoodData.businesses.map(business => `
                <tr>
                    <td>${business.name}</td>
                    <td>${business.isHCP ? '<span class="badge badge-success">HCP Active</span>' : '<span class="badge badge-secondary">No HCP</span>'}</td>
                    <td>${business.isHCP ? '$230.77/week' : '-'}</td>
                    <td>
                        ${!business.isHCP ? 
                            `<button class="btn btn-success" style="padding: 5px 10px; font-size: 12px;" onclick="toggleHCP('${business.name}', true)">Make HCP</button>` :
                            `<button class="btn btn-warning" style="padding: 5px 10px; font-size: 12px;" onclick="toggleHCP('${business.name}', false)">Remove HCP</button>`
                        }
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px; margin-left: 5px;" onclick="removeBusiness('${business.name}')">Delete</button>
                    </td>
                </tr>
            `).join('');
            
            // Update HCP summary
            updateHCPSummary();
        }
        
        // Update HCP summary
        function updateHCPSummary() {
            const hcpBusinesses = inwoodData.businesses.filter(b => b.isHCP);
            const totalWeeklyHCP = hcpBusinesses.reduce((sum, b) => sum + b.hcpWeekly, 0);
            const monthlyHCP = totalWeeklyHCP * 4.33; // Average weeks per month
            const yearlyHCP = totalWeeklyHCP * 52;
            
            const hcpSummary = document.getElementById('hcpSummary');
            hcpSummary.innerHTML = `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <h4>Active HCP Businesses:</h4>
                    ${hcpBusinesses.length > 0 ? 
                        hcpBusinesses.map(b => `<div>â€¢ ${b.name}: ${b.hcpWeekly.toFixed(2)}/week</div>`).join('') :
                        '<div>No HCP businesses active</div>'
                    }
                    <hr style="margin: 15px 0;">
                    <div><strong>Total Weekly HCP:</strong> ${totalWeeklyHCP.toFixed(2)}</div>
                    <div><strong>Estimated Monthly:</strong> ${monthlyHCP.toFixed(2)}</div>
                    <div><strong>Estimated Yearly:</strong> ${yearlyHCP.toFixed(2)}</div>
                </div>
            `;
        }
        
        // Add new driver
        function addDriver() {
            const newDriver = document.getElementById('newDriverName').value.trim();
            if (!newDriver) {
                alert('Please enter a driver name');
                return;
            }
            
            if (inwoodData.drivers.includes(newDriver)) {
                alert('This driver already exists');
                return;
            }
            
            inwoodData.drivers.push(newDriver);
            saveData();
            document.getElementById('newDriverName').value = '';
            loadSettings();
            alert(`Driver "${newDriver}" added successfully!`);
        }
        
        // Remove driver
        function removeDriver(driver) {
            if (!confirm(`Are you sure you want to remove ${driver}? Their delivery history will be kept.`)) {
                return;
            }
            
            inwoodData.drivers = inwoodData.drivers.filter(d => d !== driver);
            saveData();
            loadSettings();
        }
        
        // Add new business
        function addBusiness() {
            const newBusiness = document.getElementById('newBusinessName').value.trim();
            const isHCP = document.getElementById('newBusinessHCP').value === 'yes';
            
            if (!newBusiness) {
                alert('Please enter a business name');
                return;
            }
            
            if (inwoodData.businesses.some(b => b.name === newBusiness)) {
                alert('This business already exists');
                return;
            }
            
            inwoodData.businesses.push({
                name: newBusiness,
                isHCP: isHCP,
                hcpWeekly: isHCP ? 230.77 : 0
            });
            
            saveData();
            document.getElementById('newBusinessName').value = '';
            document.getElementById('newBusinessHCP').value = 'no';
            loadSettings();
            alert(`Business "${newBusiness}" added successfully!${isHCP ? ' (HCP Active)' : ''}`);
        }
        
        // Remove business
        function removeBusiness(business) {
            if (!confirm(`Are you sure you want to remove ${business}? Their delivery history will be kept.`)) {
                return;
            }
            
            inwoodData.businesses = inwoodData.businesses.filter(b => b.name !== business);
            saveData();
            loadSettings();
        }
        
        // Toggle HCP status for a business
        function toggleHCP(businessName, makeHCP) {
            const business = inwoodData.businesses.find(b => b.name === businessName);
            if (!business) return;
            
            if (makeHCP) {
                const customAmount = prompt('Enter weekly HCP amount (or leave empty for default $230.77):');
                const amount = customAmount ? parseFloat(customAmount) : 230.77;
                
                business.isHCP = true;
                business.hcpWeekly = amount;
                alert(`${businessName} is now an HCP business receiving ${amount.toFixed(2)}/week`);
            } else {
                business.isHCP = false;
                business.hcpWeekly = 0;
                alert(`${businessName} is no longer an HCP business`);
            }
            
            saveData();
            loadSettings();
        }

        // Set financial period
        function setPeriod(period) {
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateFinancialOverview(period);
        }

        // Update financial overview based on period
        function updateFinancialOverview(period) {
            let startDate, endDate;
            const today = new Date('2025-08-16');
            
            switch(period) {
                case 'wtd':
                    startDate = new Date('2025-08-11');
                    endDate = new Date('2025-08-17');
                    break;
                case 'mtd':
                    startDate = new Date('2025-08-01');
                    endDate = new Date('2025-08-31');
                    break;
                case 'ytd':
                    startDate = new Date('2025-01-01');
                    endDate = new Date('2025-12-31');
                    break;
                case 'all':
                    startDate = new Date('2025-01-01');
                    endDate = new Date('2025-12-31');
                    // Include historical estimated months
                    break;
            }
            
            const periodDeliveries = inwoodData.deliveries.filter(d => {
                const date = new Date(d.date);
                return date >= startDate && date <= endDate;
            });
            
            let totalPackages = 0;
            let totalGross = 0;
            let totalCost = 0;
            
            // Group deliveries by date and business for proper daily calculation
            const dailyTotals = {};
            periodDeliveries.forEach(d => {
                const key = `${d.date}-${d.business}`;
                if (!dailyTotals[key]) {
                    dailyTotals[key] = {date: d.date, business: d.business, packages: 0};
                }
                dailyTotals[key].packages += d.packages;
                totalPackages += d.packages;
                totalCost += calculateDriverPay(d.packages);
            });
            
            // Calculate Amazon pay based on daily totals
            Object.values(dailyTotals).forEach(daily => {
                totalGross += calculateAmazonPay(daily.packages);
            });
            
            // Add historical estimates if showing all time
            if (period === 'all' || period === 'ytd') {
                inwoodData.historicalMonths.forEach(month => {
                    totalGross += month.gross;
                    totalCost += month.driverCost;
                });
            }
            
            const netProfit = totalGross - totalCost;
            const margin = totalGross > 0 ? ((netProfit / totalGross) * 100).toFixed(1) : 0;
            
            document.getElementById('grossRevenue').textContent = `${totalGross.toFixed(2)}`;
            document.getElementById('totalCosts').textContent = `${totalCost.toFixed(2)}`;
            document.getElementById('netProfit').textContent = `${netProfit.toFixed(2)}`;
            document.getElementById('profitMargin').textContent = `${margin}%`;
            
            // Update business performance table based on period
            updateBusinessPerformanceTable(periodDeliveries, period);
            updateDriverEarningsTable(periodDeliveries, period);
        }
        
        function updateBusinessPerformanceTable(deliveries, period) {
            const businesses = ['Senor Bigote', '809 Restaurant', 'Cana Stays'];
            const tbody = document.getElementById('businessPerformance');
            
            tbody.innerHTML = businesses.map(business => {
                const businessDeliveries = deliveries.filter(d => d.business === business);
                
                // Group by date for proper daily calculation
                const dailyTotals = {};
                businessDeliveries.forEach(d => {
                    if (!dailyTotals[d.date]) {
                        dailyTotals[d.date] = 0;
                    }
                    dailyTotals[d.date] += d.packages;
                });
                
                let gross = 0;
                Object.values(dailyTotals).forEach(packages => {
                    gross += calculateAmazonPay(packages);
                });
                
                const costs = businessDeliveries.reduce((sum, d) => sum + calculateDriverPay(d.packages), 0);
                const net = gross - costs;
                const margin = gross > 0 ? ((net / gross) * 100).toFixed(1) : 0;
                
                return `
                    <tr>
                        <td>${business}</td>
                        <td>${gross.toFixed(2)}</td>
                        <td>${net.toFixed(2)}</td>
                        <td>${margin}%</td>
                    </tr>
                `;
            }).join('');
        }
        
        function updateDriverEarningsTable(deliveries, period) {
            const drivers = ['Gabriel', 'Rafa JR', 'Jeuris'];
            const tbody = document.getElementById('driverEarnings');
            
            tbody.innerHTML = drivers.map(driver => {
                const driverDeliveries = deliveries.filter(d => d.driver === driver);
                const packages = driverDeliveries.reduce((sum, d) => sum + d.packages, 0);
                const earnings = calculateDriverPay(packages);
                const daysWorked = new Set(driverDeliveries.map(d => d.date)).size;
                const avgPerDay = daysWorked > 0 ? (earnings / daysWorked).toFixed(2) : '0.00';
                
                return `
                    <tr>
                        <td>${driver}</td>
                        <td>${packages}</td>
                        <td>${earnings.toFixed(2)}</td>
                        <td>${avgPerDay}</td>
                    </tr>
                `;
            }).join('');
        }

        // Update preview
        document.getElementById('deliveryPackages').addEventListener('input', function() {
            const packages = parseInt(this.value) || 0;
            const amazon = calculateAmazonPay(packages);
            const driver = calculateDriverPay(packages);
            const profit = amazon - driver;
            
            document.getElementById('previewAmazon').textContent = amazon.toFixed(2);
            document.getElementById('previewDriver').textContent = driver.toFixed(2);
            document.getElementById('previewProfit').textContent = profit.toFixed(2);
        });

        // Add delivery
        function addDelivery() {
            const date = document.getElementById('deliveryDate').value;
            const driver = document.getElementById('deliveryDriver').value;
            const business = document.getElementById('deliveryBusiness').value;
            const packages = parseInt(document.getElementById('deliveryPackages').value);
            
            if (!date || !driver || !business || !packages) {
                alert('Please fill all fields');
                return;
            }
            
            inwoodData.deliveries.push({date, driver, business, packages});
            saveData();
            clearForm();
            loadRecentEntries();
            alert('Delivery added successfully!');
        }

        // Clear form
        function clearForm() {
            document.getElementById('deliveryDriver').value = '';
            document.getElementById('deliveryBusiness').value = '';
            document.getElementById('deliveryPackages').value = '';
            document.getElementById('previewAmazon').textContent = '0.00';
            document.getElementById('previewDriver').textContent = '0.00';
            document.getElementById('previewProfit').textContent = '0.00';
        }

        // Load recent entries
        function loadRecentEntries() {
            const tbody = document.getElementById('recentEntries');
            const recent = inwoodData.deliveries.slice(-10).reverse();
            
            tbody.innerHTML = recent.map((d, i) => {
                const amazon = calculateAmazonPay(d.packages);
                const driver = calculateDriverPay(d.packages);
                const profit = amazon - driver;
                
                return `
                    <tr>
                        <td>${d.date}</td>
                        <td>${d.driver}</td>
                        <td>${d.business}</td>
                        <td>${d.packages}</td>
                        <td>$${amazon.toFixed(2)}</td>
                        <td>$${driver.toFixed(2)}</td>
                        <td style="color: #27ae60;">$${profit.toFixed(2)}</td>
                        <td><button class="btn btn-danger" onclick="deleteEntry(${inwoodData.deliveries.length - 10 + i})">Delete</button></td>
                    </tr>
                `;
            }).join('');
        }

        // Delete entry
        function deleteEntry(index) {
            if (confirm('Delete this entry?')) {
                inwoodData.deliveries.splice(index, 1);
                saveData();
                loadRecentEntries();
            }
        }

        // Load week for payouts
        function loadWeek() {
            const weekValue = document.getElementById('payoutWeek').value;
            if (!weekValue) return;
            
            const [year, week] = weekValue.split('-W');
            const firstDay = new Date(year, 0, (week - 1) * 7 + 1);
            const lastDay = new Date(firstDay);
            lastDay.setDate(lastDay.getDate() + 6);
            
            const weekDeliveries = inwoodData.deliveries.filter(d => {
                const date = new Date(d.date);
                return date >= firstDay && date <= lastDay;
            });
            
            const tbody = document.getElementById('payoutBody');
            tbody.innerHTML = '';
            
            const totals = {
                'Gabriel': 0,
                'Rafa JR': 0,
                'Jeuris': 0
            };
            
            // Check if payments exist for this week
            const weekPayments = inwoodData.payments.filter(p => p.week === weekValue);
            const paidDrivers = {};
            weekPayments.forEach(p => {
                paidDrivers[p.driver] = true;
            });
            
            weekDeliveries.forEach(d => {
                const amount = calculateDriverPay(d.packages);
                if (totals[d.driver] !== undefined) {
                    totals[d.driver] += amount;
                }
                
                const isPaid = paidDrivers[d.driver] || false;
                
                tbody.innerHTML += `
                    <tr>
                        <td>${d.date}</td>
                        <td>${d.driver}</td>
                        <td>${d.business}</td>
                        <td>${d.packages}</td>
                        <td>${amount.toFixed(2)}</td>
                        <td>${isPaid ? '<span class="badge badge-success">Paid</span>' : '<span class="badge badge-warning">Pending</span>'}</td>
                    </tr>
                `;
            });
            
            document.getElementById('gabrielTotal').textContent = totals['Gabriel'].toFixed(2);
            document.getElementById('rafaTotal').textContent = totals['Rafa JR'].toFixed(2);
            document.getElementById('jeurisTotal').textContent = totals['Jeuris'].toFixed(2);
            document.getElementById('weekTotal').textContent = 
                (totals['Gabriel'] + totals['Rafa JR'] + totals['Jeuris']).toFixed(2);
        }

        // Validate payment
        function validatePayment() {
            const start = document.getElementById('validStart').value;
            const end = document.getElementById('validEnd').value;
            
            if (!start || !end) {
                alert('Please select both dates');
                return;
            }
            
            const rangeDeliveries = inwoodData.deliveries.filter(d => {
                return d.date >= start && d.date <= end;
            });
            
            const byBusiness = {};
            let totalPackages = 0;
            let totalAmazon = 0;
            let totalDriver = 0;
            
            rangeDeliveries.forEach(d => {
                if (!byBusiness[d.business]) {
                    byBusiness[d.business] = {packages: 0, amazon: 0, driver: 0};
                }
                byBusiness[d.business].packages += d.packages;
                const amazon = calculateAmazonPay(d.packages);
                const driver = calculateDriverPay(d.packages);
                byBusiness[d.business].amazon += amazon;
                byBusiness[d.business].driver += driver;
                totalPackages += d.packages;
                totalAmazon += amazon;
                totalDriver += driver;
            });
            
            let html = `
                <h3>Validation Results: ${start} to ${end}</h3>
                <table style="width: 100%; margin-top: 15px;">
                    <tr>
                        <th>Business</th>
                        <th>Packages</th>
                        <th>Amazon Owes</th>
                    </tr>
            `;
            
            Object.keys(byBusiness).forEach(business => {
                html += `
                    <tr>
                        <td>${business}</td>
                        <td>${byBusiness[business].packages}</td>
                        <td>$${byBusiness[business].amazon.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            html += `
                    <tr style="font-weight: bold; background: #f8f9fa;">
                        <td>TOTAL</td>
                        <td>${totalPackages}</td>
                        <td>$${totalAmazon.toFixed(2)}</td>
                    </tr>
                </table>
                <div style="margin-top: 20px;">
                    <strong>Amazon should pay you: $${totalAmazon.toFixed(2)}</strong><br>
                    <strong>You pay drivers: $${totalDriver.toFixed(2)}</strong><br>
                    <strong>Your profit: $${(totalAmazon - totalDriver).toFixed(2)}</strong>
                </div>
            `;
            
            document.getElementById('validationResult').innerHTML = html;
            document.getElementById('validationResult').style.display = 'block';
        }

        // Add historical month
        function addHistorical() {
            const month = document.getElementById('historyMonth').value;
            const gross = parseFloat(document.getElementById('historyGross').value);
            const costPercent = parseFloat(document.getElementById('historyCostPercent').value) / 100;
            
            if (!month || !gross) {
                alert('Please fill month and gross revenue');
                return;
            }
            
            const driverCost = gross * costPercent;
            const net = gross - driverCost;
            
            inwoodData.historicalMonths.push({
                month,
                gross,
                driverCost,
                net,
                estimated: true
            });
            
            saveData();
            alert('Historical month added!');
        }

        // Save and load data
        function saveData() {
            localStorage.setItem('inwoodLogisticsData', JSON.stringify(inwoodData));
        }

        function loadData() {
            const saved = localStorage.getItem('inwoodLogisticsData');
            if (saved) {
                inwoodData = JSON.parse(saved);
            }
        }

        // Utility functions
        function markAllPaid() {
            const weekValue = document.getElementById('payoutWeek').value;
            if (!weekValue) {
                alert('Please select a week first');
                return;
            }
            
            const [year, week] = weekValue.split('-W');
            const firstDay = new Date(year, 0, (week - 1) * 7 + 1);
            const lastDay = new Date(firstDay);
            lastDay.setDate(lastDay.getDate() + 6);
            
            const weekDeliveries = inwoodData.deliveries.filter(d => {
                const date = new Date(d.date);
                return date >= firstDay && date <= lastDay;
            });
            
            // Calculate totals for each driver
            const driverTotals = {};
            weekDeliveries.forEach(d => {
                if (!driverTotals[d.driver]) {
                    driverTotals[d.driver] = 0;
                }
                driverTotals[d.driver] += calculateDriverPay(d.packages);
            });
            
            // Add payment records
            Object.keys(driverTotals).forEach(driver => {
                if (driverTotals[driver] > 0) {
                    // Check if payment already exists
                    const existingPayment = inwoodData.payments.find(p => 
                        p.week === weekValue && p.driver === driver
                    );
                    
                    if (!existingPayment) {
                        inwoodData.payments.push({
                            week: weekValue,
                            driver: driver,
                            amount: driverTotals[driver],
                            paid: true,
                            date: new Date().toISOString().split('T')[0]
                        });
                    }
                }
            });
            
            saveData();
            loadWeek();
            alert('All drivers marked as paid for this week!');
        }

        function exportWeek() {
            const weekValue = document.getElementById('payoutWeek').value;
            if (!weekValue) {
                alert('Please select a week first');
                return;
            }
            
            alert('CSV export functionality would download a file with the week\'s data');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            loadWeek();
            updateFinancialOverview('wtd');
            updateDeliveryDropdowns();
        });
    </script>
</body>
</html>
