<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inwood Logistics - Professional Hub Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            color: #1a1a1a;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 300;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .tabs {
            background: white;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
            display: flex;
            gap: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background: #f8f9fa;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .stat-card h3 {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .stat-card .value {
            font-size: 28px;
            font-weight: bold;
            color: #1a1a1a;
        }
        
        .stat-card .change {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .stat-card.green .value {
            color: #27ae60;
        }
        
        .stat-card.blue .value {
            color: #3498db;
        }
        
        .stat-card.orange .value {
            color: #e67e22;
        }
        
        .stat-card.red .value {
            color: #e74c3c;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .card h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #e9ecef;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #f1f3f4;
            font-size: 14px;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: 500;
            color: #495057;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .period-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .period-btn {
            padding: 8px 16px;
            border: 1px solid #dee2e6;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .period-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .alert {
            padding: 12px 20px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quick-action-btn {
            padding: 15px;
            text-align: center;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .quick-action-btn:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }
        
        .quick-action-btn .icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .quick-action-btn .label {
            font-size: 12px;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>📦 Inwood Logistics Hub Management</h1>
        <p>Professional Amazon Delivery Tracking & Financial Analytics</p>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="tab" onclick="switchTab('financial')">Financial Overview</button>
            <button class="tab" onclick="switchTab('businessView')">Business Breakdown</button>
            <button class="tab" onclick="switchTab('quarterly')">Quarterly Reports</button>
            <button class="tab" onclick="switchTab('deliveries')">Add Entry</button>
            <button class="tab" onclick="switchTab('payouts')">Weekly Payouts</button>
            <button class="tab" onclick="switchTab('amazonPayments')">Amazon Payments</button>
            <button class="tab" onclick="switchTab('analytics')">Advanced Analytics</button>
            <button class="tab" onclick="switchTab('settings')">Settings</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <!-- Quick Actions -->
            <div class="quick-actions">
                <div class="quick-action-btn" onclick="quickAddDelivery()">
                    <div class="icon">➕</div>
                    <div class="label">Quick Add Delivery</div>
                </div>
                <div class="quick-action-btn" onclick="exportData()">
                    <div class="icon">📥</div>
                    <div class="label">Export Data</div>
                </div>
                <div class="quick-action-btn" onclick="backupData()">
                    <div class="icon">💾</div>
                    <div class="label">Backup</div>
                </div>
                <div class="quick-action-btn" onclick="showNotifications()">
                    <div class="icon">🔔</div>
                    <div class="label">Alerts (2)</div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Today's Profit</h3>
                    <div class="value">$0.00</div>
                    <div class="change">Saturday, August 16, 2025</div>
                </div>
                <div class="stat-card green">
                    <h3>Week-to-Date</h3>
                    <div class="value" id="wtdProfit">$440.54</div>
                    <div class="change">Aug 11-17 (incl. HCP)</div>
                </div>
                <div class="stat-card blue">
                    <h3>Month-to-Date</h3>
                    <div class="value" id="mtdProfit">$1,835.58</div>
                    <div class="change">August 2025 (incl. HCP)</div>
                </div>
                <div class="stat-card orange">
                    <h3>Year-to-Date</h3>
                    <div class="value" id="ytdProfit">$17,834.10</div>
                    <div class="change">Since Jan 2025 (incl. HCP)</div>
                </div>
            </div>

            <!-- Alerts Section -->
            <div class="alert alert-warning">
                <strong>⚠️ Payment Reminder:</strong> Gabriel ($162) and Rafa JR ($153) payments pending for current week. Total outstanding: $315.00
            </div>

            <div class="card">
                <h2>Current Week Summary (Aug 11-17, 2025)</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Business</th>
                            <th>Packages</th>
                            <th>Gross Revenue</th>
                            <th>Driver Costs</th>
                            <th>Net Profit</th>
                            <th>Margin</th>
                        </tr>
                    </thead>
                    <tbody id="weekSummaryBody">
                        <tr>
                            <td><strong>Senor Bigote</strong> <span class="badge badge-info">HCP</span></td>
                            <td>200</td>
                            <td>$337.50</td>
                            <td>$200.00</td>
                            <td style="color: #27ae60;">$137.50</td>
                            <td><span class="badge badge-success">40.7%</span></td>
                        </tr>
                        <tr>
                            <td><strong>809 Restaurant</strong></td>
                            <td>200</td>
                            <td>$337.50</td>
                            <td>$200.00</td>
                            <td style="color: #27ae60;">$137.50</td>
                            <td><span class="badge badge-success">40.7%</span></td>
                        </tr>
                        <tr>
                            <td><strong>Cana Stays</strong></td>
                            <td>191</td>
                            <td>$323.50</td>
                            <td>$191.00</td>
                            <td style="color: #27ae60;">$132.50</td>
                            <td><span class="badge badge-success">41.0%</span></td>
                        </tr>
                        <tr style="background: #f8f9fa; font-weight: bold;">
                            <td>SUBTOTAL</td>
                            <td>591</td>
                            <td>$998.50</td>
                            <td>$591.00</td>
                            <td style="color: #27ae60;">$407.50</td>
                            <td><span class="badge badge-info">40.8%</span></td>
                        </tr>
                        <tr style="background: #e8f5e9;">
                            <td colspan="4"><strong>HCP Revenue (Senor Bigote)</strong></td>
                            <td style="color: #27ae60;">$33.04</td>
                            <td><span class="badge badge-info">Daily</span></td>
                        </tr>
                        <tr style="background: #e3f2fd; font-weight: bold;">
                            <td colspan="4">TOTAL WEEK PROFIT</td>
                            <td style="color: #27ae60; font-size: 18px;">$440.54</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>Driver Payments - Current Week</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Driver</th>
                            <th>Breakdown</th>
                            <th>Total Packages</th>
                            <th>Amount Owed</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="driverPaymentsBody">
                        <tr>
                            <td><strong>Gabriel</strong></td>
                            <td>Senor Bigote: 162</td>
                            <td>162</td>
                            <td>$162.00</td>
                            <td><span class="badge badge-warning">Pending</span></td>
                            <td><button class="btn btn-success" onclick="markPaid('Gabriel', 162)">Mark Paid</button></td>
                        </tr>
                        <tr>
                            <td><strong>Rafa JR</strong></td>
                            <td>Cana Stays: 153</td>
                            <td>153</td>
                            <td>$153.00</td>
                            <td><span class="badge badge-warning">Pending</span></td>
                            <td><button class="btn btn-success" onclick="markPaid('Rafa JR', 153)">Mark Paid</button></td>
                        </tr>
                        <tr>
                            <td><strong>Jeuris</strong></td>
                            <td>809: 200, SB: 38, CS: 38</td>
                            <td>276</td>
                            <td>$276.00</td>
                            <td><span class="badge badge-success">Paid (8/14)</span></td>
                            <td>-</td>
                        </tr>
                        <tr style="background: #f8f9fa; font-weight: bold;">
                            <td>TOTAL</td>
                            <td></td>
                            <td>591</td>
                            <td>$591.00</td>
                            <td>Outstanding: $315.00</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Financial Overview Tab -->
        <div id="financial" class="tab-content">
            <div class="period-selector">
                <button class="period-btn active" onclick="setPeriod('wtd')">Week-to-Date</button>
                <button class="period-btn" onclick="setPeriod('mtd')">Month-to-Date</button>
                <button class="period-btn" onclick="setPeriod('ytd')">Year-to-Date</button>
                <button class="period-btn" onclick="setPeriod('all')">All Time</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Gross Revenue</h3>
                    <div class="value" id="grossRevenue">$998.50</div>
                    <div class="change">From Amazon</div>
                </div>
                <div class="stat-card">
                    <h3>Total Costs</h3>
                    <div class="value" id="totalCosts">$591.00</div>
                    <div class="change">Driver payments</div>
                </div>
                <div class="stat-card green">
                    <h3>Net Profit</h3>
                    <div class="value" id="netProfit">$407.50</div>
                    <div class="change">After costs</div>
                </div>
                <div class="stat-card blue">
                    <h3>Profit Margin</h3>
                    <div class="value" id="profitMargin">40.8%</div>
                    <div class="change">Efficiency rate</div>
                </div>
            </div>

            <div class="summary-grid">
                <div class="card">
                    <h2>Business Performance - WTD</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Business</th>
                                <th>Gross</th>
                                <th>Net</th>
                                <th>Margin</th>
                            </tr>
                        </thead>
                        <tbody id="businessPerformance">
                            <tr>
                                <td>Senor Bigote</td>
                                <td>$337.50</td>
                                <td>$137.50</td>
                                <td>40.7%</td>
                            </tr>
                            <tr>
                                <td>809 Restaurant</td>
                                <td>$337.50</td>
                                <td>$137.50</td>
                                <td>40.7%</td>
                            </tr>
                            <tr>
                                <td>Cana Stays</td>
                                <td>$323.50</td>
                                <td>$132.50</td>
                                <td>41.0%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <h2>Driver Earnings - WTD</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Driver</th>
                                <th>Packages</th>
                                <th>Earnings</th>
                                <th>Avg/Day</th>
                            </tr>
                        </thead>
                        <tbody id="driverEarnings">
                            <tr>
                                <td>Gabriel</td>
                                <td>162</td>
                                <td>$162.00</td>
                                <td>$40.50</td>
                            </tr>
                            <tr>
                                <td>Rafa JR</td>
                                <td>153</td>
                                <td>$153.00</td>
                                <td>$38.25</td>
                            </tr>
                            <tr>
                                <td>Jeuris</td>
                                <td>276</td>
                                <td>$276.00</td>
                                <td>$55.20</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h2>Monthly Trend</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Amazon Revenue</th>
                            <th>Driver Costs</th>
                            <th>HCP Revenue</th>
                            <th>Net Profit</th>
                            <th>Margin</th>
                        </tr>
                    </thead>
                    <tbody id="monthlyTrend">
                        <!-- Will be populated dynamically -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Add Delivery Tab -->
        <div id="deliveries" class="tab-content">
            <div class="card">
                <h2>Add New Delivery Entry</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="deliveryDate" value="2025-08-16">
                    </div>
                    <div class="form-group">
                        <label>Driver</label>
                        <select id="deliveryDriver">
                            <option value="">Select Driver</option>
                            <!-- Populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Business</label>
                        <select id="deliveryBusiness">
                            <option value="">Select Business</option>
                            <!-- Populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Packages</label>
                        <input type="number" id="deliveryPackages" min="0" placeholder="0">
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;">
                    <strong>Instant Calculation:</strong>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 10px;">
                        <div>
                            <div style="color: #666; font-size: 12px;">Amazon Pays You</div>
                            <div style="font-size: 20px; font-weight: bold;">$<span id="previewAmazon">0.00</span></div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 12px;">You Pay Driver</div>
                            <div style="font-size: 20px; font-weight: bold;">$<span id="previewDriver">0.00</span></div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 12px;">Your Profit</div>
                            <div style="font-size: 20px; font-weight: bold; color: #27ae60;">$<span id="previewProfit">0.00</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Notes (Optional)</label>
                    <textarea id="deliveryNotes" rows="3" placeholder="Add any notes..."></textarea>
                </div>
                
                <button class="btn btn-primary" onclick="addDelivery()">Add Delivery</button>
                <button class="btn btn-secondary" onclick="clearForm()">Clear Form</button>
            </div>

            <div class="card">
                <h2>Recent Entries</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Driver</th>
                            <th>Business</th>
                            <th>Packages</th>
                            <th>Revenue</th>
                            <th>Cost</th>
                            <th>Profit</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="recentEntries">
                        <!-- Will be populated -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Weekly Payouts Tab -->
        <div id="payouts" class="tab-content">
            <div class="card">
                <h2>Weekly Payouts Management</h2>
                
                <div class="form-group" style="max-width: 300px;">
                    <label>Select Week</label>
                    <input type="week" id="payoutWeek" value="2025-W33" onchange="loadWeek()">
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Driver</th>
                            <th>Business</th>
                            <th>Packages</th>
                            <th>Amount</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="payoutBody">
                        <!-- Will be populated -->
                    </tbody>
                </table>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">Week Totals</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;" id="weekTotalsDiv">
                        <!-- Will be populated -->
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-success" onclick="markAllPaid()">Mark All Paid</button>
                        <button class="btn btn-primary" onclick="exportWeek()">Export CSV</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Amazon Payments Tab -->
        <div id="amazonPayments" class="tab-content">
            <div class="card">
                <h2>Amazon Payment History</h2>
                
                <div class="period-selector">
                    <button class="period-btn active" onclick="filterAmazonPayments('all')">All</button>
                    <button class="period-btn" onclick="filterAmazonPayments('809')">809 Restaurant</button>
                    <button class="period-btn" onclick="filterAmazonPayments('sb')">Senor Bigote</button>
                    <button class="period-btn" onclick="filterAmazonPayments('cs')">Cana Stays</button>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Business</th>
                            <th>Amount Received</th>
                            <th>Expected</th>
                            <th>Variance</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="amazonPaymentsBody">
                        <!-- Will be populated -->
                    </tbody>
                </table>
            </div>

            <div class="summary-grid">
                <div class="card">
                    <h2>Payment Summary by Business</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Business</th>
                                <th>Total Received</th>
                                <th>Avg/Month</th>
                                <th>Trend</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>809 Restaurant</strong></td>
                                <td>$7,962.50</td>
                                <td>$1,137.50</td>
                                <td><span class="badge badge-success">↑ Growing</span></td>
                            </tr>
                            <tr>
                                <td><strong>Senor Bigote</strong> <span class="badge badge-info">HCP</span></td>
                                <td>$15,000.00</td>
                                <td>$2,142.86</td>
                                <td><span class="badge badge-success">↑ Growing</span></td>
                            </tr>
                            <tr>
                                <td><strong>Cana Stays</strong></td>
                                <td>$2,513.00</td>
                                <td>$1,256.50</td>
                                <td><span class="badge badge-warning">→ Stable</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <h2>HCP Payment Tracking</h2>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <h4>Senor Bigote HCP Details:</h4>
                        <div style="margin-top: 10px;">
                            <div>• Started: June 2, 2025</div>
                            <div>• Weekly Amount: $230.77</div>
                            <div>• Total HCP Received: $2,538.47</div>
                            <div>• Weeks Active: 11</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Business Breakdown Tab -->
        <div id="businessView" class="tab-content">
            <div class="card">
                <h2>Select Business to Analyze</h2>
                <div class="period-selector">
                    <button class="period-btn active" onclick="viewBusiness('all')">All Businesses</button>
                    <button class="period-btn" onclick="viewBusiness('Senor Bigote')">Senor Bigote</button>
                    <button class="period-btn" onclick="viewBusiness('809 Restaurant')">809 Restaurant</button>
                    <button class="period-btn" onclick="viewBusiness('Cana Stays')">Cana Stays</button>
                </div>
            </div>

            <div id="businessDetails">
                <!-- Will be populated with business-specific data -->
            </div>
        </div>

        <!-- Quarterly Reports Tab -->
        <div id="quarterly" class="tab-content">
            <div class="card">
                <h2>Quarterly Tax Summaries</h2>
                <div class="period-selector">
                    <button class="period-btn" onclick="loadQuarter('Q1')">Q1 2025 (Jan-Mar)</button>
                    <button class="period-btn" onclick="loadQuarter('Q2')">Q2 2025 (Apr-Jun)</button>
                    <button class="period-btn active" onclick="loadQuarter('Q3')">Q3 2025 (Jul-Sep)</button>
                    <button class="period-btn" onclick="loadQuarter('Q4')">Q4 2025 (Oct-Dec)</button>
                </div>
            </div>

            <div id="quarterlyReport" style="margin-top: 20px;">
                <!-- Will be populated with quarterly data -->
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="card">
                <h2>Advanced Business Analytics</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>30-Day Projection</h3>
                        <div class="value" id="projection30">$2,145.00</div>
                        <div class="change">Based on 7-day average</div>
                    </div>
                    <div class="stat-card green">
                        <h3>90-Day Projection</h3>
                        <div class="value" id="projection90">$6,435.00</div>
                        <div class="change">Based on 30-day trend</div>
                    </div>
                    <div class="stat-card blue">
                        <h3>Year-End Projection</h3>
                        <div class="value" id="projectionYear">$25,740.00</div>
                        <div class="change">At current growth rate</div>
                    </div>
                    <div class="stat-card orange">
                        <h3>Break-Even Point</h3>
                        <div class="value">295 packages</div>
                        <div class="change">Weekly minimum needed</div>
                    </div>
                </div>
            </div>

            <div class="summary-grid">
                <div class="card">
                    <h2>Business Comparison Matrix</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Senor Bigote</th>
                                <th>809 Restaurant</th>
                                <th>Cana Stays</th>
                            </tr>
                        </thead>
                        <tbody id="comparisonMatrix">
                            <!-- Will be populated -->
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <h2>Growth Analysis</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Period</th>
                                <th>Revenue</th>
                                <th>Growth %</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="growthAnalysis">
                            <!-- Will be populated -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h2>Seasonal Trends & Insights</h2>
                <div id="seasonalInsights" style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <!-- Will be populated with insights -->
                </div>
            </div>

            <div class="card">
                <h2>Profitability Analysis</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Business</th>
                            <th>Revenue/Package</th>
                            <th>Profit Margin</th>
                            <th>Weekly Average</th>
                            <th>Recommendation</th>
                        </tr>
                    </thead>
                    <tbody id="profitabilityAnalysis">
                        <!-- Will be populated -->
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>Amazon Payment Validation Tool</h2>
                
                <div class="alert alert-info" style="margin-bottom: 20px;">
                    <strong>⚠️ Important:</strong> Amazon weeks run Sunday-Saturday, while your tracking runs Monday-Sunday. 
                    This tool automatically adjusts for the difference.
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Validation Type</label>
                        <select id="validationType" onchange="updateValidationDates()">
                            <option value="custom">Custom Date Range</option>
                            <option value="amazon">Amazon Week (Sun-Sat)</option>
                            <option value="business">Your Week (Mon-Sun)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Start Date</label>
                        <input type="date" id="validStart">
                    </div>
                    <div class="form-group">
                        <label>End Date</label>
                        <input type="date" id="validEnd">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Amazon Payment Amount (Optional)</label>
                        <input type="number" id="amazonPaymentAmount" placeholder="0.00" step="0.01">
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button class="btn btn-primary" onclick="validatePayment()">Validate Payment</button>
                        <button class="btn btn-secondary" style="margin-left: 10px;" onclick="quickValidateLastWeek()">Quick: Last Amazon Week</button>
                    </div>
                </div>
                
                <div id="validationResult" style="display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <!-- Results will appear here -->
                </div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="card">
                <h2>Manage Drivers</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 20px;" id="driversList">
                    <!-- Will be populated with current drivers -->
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Add New Driver</label>
                        <input type="text" id="newDriverName" placeholder="Enter driver name">
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button class="btn btn-primary" onclick="addDriver()">Add Driver</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Manage Businesses</h2>
                
                <table id="businessManagementTable">
                    <thead>
                        <tr>
                            <th>Business Name</th>
                            <th>HCP Status</th>
                            <th>Weekly HCP Payment</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="businessList">
                        <!-- Will be populated with current businesses -->
                    </tbody>
                </table>
                
                <div class="form-row" style="margin-top: 20px;">
                    <div class="form-group">
                        <label>Add New Business</label>
                        <input type="text" id="newBusinessName" placeholder="Enter business name">
                    </div>
                    <div class="form-group">
                        <label>Make it HCP?</label>
                        <select id="newBusinessHCP">
                            <option value="no">No</option>
                            <option value="yes">Yes - $230.77/week</option>
                        </select>
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button class="btn btn-primary" onclick="addBusiness()">Add Business</button>
                    </div>
                </div>
                
                <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <small><strong>Note:</strong> When making a business HCP, you can set a custom weekly amount or use the default $230.77.</small>
                </div>
            </div>
            
            <div class="card">
                <h2>HCP Revenue Summary</h2>
                <div id="hcpSummary">
                    <!-- Will show current HCP businesses and revenue -->
                </div>
            </div>

            <div class="card">
                <h2>Data Management</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <button class="btn btn-primary" onclick="exportAllData()">📥 Export All Data</button>
                    <button class="btn btn-success" onclick="backupData()">💾 Backup to File</button>
                    <button class="btn btn-secondary" onclick="restoreData()">📂 Restore from File</button>
                    <button class="btn btn-danger" onclick="clearAllData()">🗑️ Clear All Data</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Complete data structure with all historical data
        let inwoodData = {
            drivers: ['Gabriel', 'Rafa JR', 'Jeuris'],
            
            businesses: [
                {name: 'Senor Bigote', isHCP: true, hcpWeekly: 230.77, hcpStartDate: '2025-06-02'},
                {name: '809 Restaurant', isHCP: false, hcpWeekly: 0},
                {name: 'Cana Stays', isHCP: false, hcpWeekly: 0}
            ],
            
            // Amazon payment history from screenshots
            amazonPayments: [
                // 809 Restaurant
                {month: '2025-08', business: '809 Restaurant', amount: 1007.50},
                {month: '2025-07', business: '809 Restaurant', amount: 2151.00},
                {month: '2025-06', business: '809 Restaurant', amount: 1974.50},
                {month: '2025-05', business: '809 Restaurant', amount: 1856.00},
                
                // Senor Bigote
                {month: '2025-08', business: 'Senor Bigote', amount: 1395.04},
                {month: '2025-07', business: 'Senor Bigote', amount: 3261.11},
                {month: '2025-06', business: 'Senor Bigote', amount: 3152.08},
                {month: '2025-05', business: 'Senor Bigote', amount: 2691.27},
                {month: '2025-04', business: 'Senor Bigote', amount: 2265.00},
                {month: '2025-03', business: 'Senor Bigote', amount: 2079.50},
                {month: '2025-02', business: 'Senor Bigote', amount: 178.00},
                
                // Cana Stays
                {month: '2025-08', business: 'Cana Stays', amount: 970.00},
                {month: '2025-07', business: 'Cana Stays', amount: 1543.00}
            ],
            
            deliveries: [
                // Week of July 21-27, 2025
                {date: '2025-07-21', driver: 'Gabriel', business: '809 Restaurant', packages: 40},
                {date: '2025-07-21', driver: 'Gabriel', business: 'Senor Bigote', packages: 39},
                {date: '2025-07-22', driver: 'Gabriel', business: '809 Restaurant', packages: 41},
                {date: '2025-07-22', driver: 'Gabriel', business: 'Senor Bigote', packages: 41},
                {date: '2025-07-21', driver: 'Rafa JR', business: 'Cana Stays', packages: 42},
                {date: '2025-07-22', driver: 'Rafa JR', business: 'Cana Stays', packages: 42},
                {date: '2025-07-23', driver: 'Rafa JR', business: 'Cana Stays', packages: 42},
                {date: '2025-07-24', driver: 'Rafa JR', business: 'Cana Stays', packages: 40},
                {date: '2025-07-25', driver: 'Rafa JR', business: 'Cana Stays', packages: 38},
                {date: '2025-07-25', driver: 'Jeuris', business: '809 Restaurant', packages: 36},
                {date: '2025-07-25', driver: 'Jeuris', business: 'Senor Bigote', packages: 39},
                {date: '2025-07-27', driver: 'Rafa JR', business: 'Cana Stays', packages: 37},
                
                // Week of July 28 - Aug 3, 2025
                {date: '2025-07-28', driver: 'Rafa JR', business: 'Cana Stays', packages: 38},
                {date: '2025-07-29', driver: 'Rafa JR', business: 'Cana Stays', packages: 40},
                {date: '2025-07-30', driver: 'Rafa JR', business: 'Cana Stays', packages: 38},
                {date: '2025-07-31', driver: 'Rafa JR', business: 'Cana Stays', packages: 30},
                {date: '2025-08-01', driver: 'Rafa JR', business: 'Cana Stays', packages: 40},
                {date: '2025-08-02', driver: 'Rafa JR', business: 'Senor Bigote', packages: 38},
                {date: '2025-08-02', driver: 'Rafa JR', business: '809 Restaurant', packages: 40},
                {date: '2025-08-02', driver: 'Rafa JR', business: 'Cana Stays', packages: 36},
                // Jeuris worked Monday-Friday both businesses (using 38 packages default)
                {date: '2025-07-28', driver: 'Jeuris', business: '809 Restaurant', packages: 38},
                {date: '2025-07-28', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-07-29', driver: 'Jeuris', business: '809 Restaurant', packages: 38},
                {date: '2025-07-29', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-07-30', driver: 'Jeuris', business: '809 Restaurant', packages: 38},
                {date: '2025-07-30', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-07-31', driver: 'Jeuris', business: '809 Restaurant', packages: 38},
                {date: '2025-07-31', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-08-01', driver: 'Jeuris', business: '809 Restaurant', packages: 38},
                {date: '2025-08-01', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-08-03', driver: 'Jeuris', business: '809 Restaurant', packages: 38},
                {date: '2025-08-03', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-08-03', driver: 'Jeuris', business: 'Cana Stays', packages: 38},
                
                // Week of Aug 4-10, 2025
                {date: '2025-08-04', driver: 'Rafa JR', business: 'Cana Stays', packages: 38},
                {date: '2025-08-05', driver: 'Rafa JR', business: 'Cana Stays', packages: 39},
                {date: '2025-08-06', driver: 'Rafa JR', business: 'Cana Stays', packages: 40},
                {date: '2025-08-07', driver: 'Rafa JR', business: 'Cana Stays', packages: 37},
                {date: '2025-08-08', driver: 'Rafa JR', business: 'Cana Stays', packages: 39},
                {date: '2025-08-09', driver: 'Rafa JR', business: 'Cana Stays', packages: 39},
                {date: '2025-08-09', driver: 'Gabriel', business: 'Senor Bigote', packages: 42},
                {date: '2025-08-10', driver: 'Gabriel', business: 'Cana Stays', packages: 41},
                {date: '2025-08-10', driver: 'Gabriel', business: 'Senor Bigote', packages: 43},
                {date: '2025-08-04', driver: 'Jeuris', business: '809 Restaurant', packages: 41},
                {date: '2025-08-04', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-08-05', driver: 'Jeuris', business: '809 Restaurant', packages: 41},
                {date: '2025-08-05', driver: 'Jeuris', business: 'Senor Bigote', packages: 40},
                {date: '2025-08-06', driver: 'Jeuris', business: '809 Restaurant', packages: 40},
                {date: '2025-08-06', driver: 'Jeuris', business: 'Senor Bigote', packages: 40},
                {date: '2025-08-07', driver: 'Jeuris', business: '809 Restaurant', packages: 36},
                {date: '2025-08-07', driver: 'Jeuris', business: 'Senor Bigote', packages: 38},
                {date: '2025-08-08', driver: 'Jeuris', business: '809 Restaurant', packages: 40},
                {date: '2025-08-08', driver: 'Jeuris', business: 'Senor Bigote', packages: 40},
                {date: '2025-08-09', driver: 'Jeuris', business: '809 Restaurant', packages: 42},
                {date: '2025-08-10', driver: 'Jeuris', business: '809 Restaurant', packages: 42},
                
                // Week of Aug 11-17, 2025 - CURRENT WEEK
                {date: '2025-08-11', driver: 'Gabriel', business: 'Senor Bigote', packages: 41},
                {date: '2025-08-12', driver: 'Gabriel', business: 'Senor Bigote', packages: 42},
                {date: '2025-08-13', driver: 'Gabriel', business: 'Senor Bigote', packages: 41},
                {date: '2025-08-14', driver: 'Gabriel', business: 'Senor Bigote', packages: 38},
                {date: '2025-08-11', driver: 'Rafa JR', business: 'Cana Stays', packages: 38},
                {date: '2025-08-13', driver: 'Rafa JR', business: 'Cana Stays', packages: 40},
                {date: '2025-08-14', driver: 'Rafa JR', business: 'Cana Stays', packages: 37},
                {date: '2025-08-15', driver: 'Rafa JR', business: 'Cana Stays', packages: 38},
                {date: '2025-08-11', driver: 'Jeuris', business: '809 Restaurant', packages: 41},
                {date: '2025-08-12', driver: 'Jeuris', business: '809 Restaurant', packages: 40},
                {date: '2025-08-12', driver: 'Jeuris', business: 'Cana Stays', packages: 38},
                {date: '2025-08-13', driver: 'Jeuris', business: '809 Restaurant', packages: 41},
                {date: '2025-08-14', driver: 'Jeuris', business: '809 Restaurant', packages: 40},
                {date: '2025-08-15', driver: 'Jeuris', business: '809 Restaurant', packages: 38},
                {date: '2025-08-15', driver: 'Jeuris', business: 'Senor Bigote', packages: 38}
            ],
            
            payments: [
                // Week July 21-27: PAID
                {week: '2025-W30', driver: 'Gabriel', amount: 161, paid: true, date: '2025-07-29'},
                {week: '2025-W30', driver: 'Rafa JR', amount: 241, paid: true, date: '2025-07-29'},
                {week: '2025-W30', driver: 'Jeuris', amount: 75, paid: true, date: '2025-07-29'},
                
                // Week July 28-Aug 3: PAID
                {week: '2025-W31', driver: 'Rafa JR', amount: 300, paid: true, date: '2025-08-07'},
                {week: '2025-W31', driver: 'Jeuris', amount: 494, paid: true, date: '2025-08-07'},
                
                // Week Aug 4-10: PAID
                {week: '2025-W32', driver: 'Gabriel', amount: 126, paid: true, date: '2025-08-11'},
                {week: '2025-W32', driver: 'Rafa JR', amount: 232, paid: true, date: '2025-08-11'},
                {week: '2025-W32', driver: 'Jeuris', amount: 478, paid: true, date: '2025-08-11'},
                
                // Week Aug 11-17: CURRENT WEEK
                {week: '2025-W33', driver: 'Jeuris', amount: 276, paid: true, date: '2025-08-14'} // Prepaid
            ],

            notes: []
        };

        // Calculate functions
        function calculateAmazonPay(packages) {
            if (packages <= 25) {
                return packages * 2.00;
            } else {
                return (25 * 2.00) + ((packages - 25) * 1.50);
            }
        }

        function calculateDriverPay(packages) {
            return packages * 1.00;
        }

        function calculateHCPRevenue(business, startDate, endDate) {
            if (!business.isHCP) return 0;
            
            const start = new Date(Math.max(new Date(business.hcpStartDate), new Date(startDate)));
            const end = new Date(endDate);
            
            if (start > end) return 0;
            
            const days = Math.floor((end - start) / (1000 * 60 * 60 * 24)) + 1;
            const dailyHCP = business.hcpWeekly / 7;
            
            return days * dailyHCP;
        }

        // Switch tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'deliveries') {
                loadRecentEntries();
                updateDeliveryDropdowns();
            } else if (tabName === 'payouts') {
                loadWeek();
            } else if (tabName === 'settings') {
                loadSettings();
            } else if (tabName === 'amazonPayments') {
                loadAmazonPayments();

            } else if (tabName === 'financial') {
                updateFinancialOverview('wtd');
            } else if (tabName === 'businessView') {
                viewBusiness('all');
            } else if (tabName === 'quarterly') {
                loadQuarter('Q3');
            } else if (tabName === 'analytics') {
                loadAdvancedAnalytics();
            }
        }

        // View individual business
        function viewBusiness(businessName) {
            document.querySelectorAll('#businessView .period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const detailsDiv = document.getElementById('businessDetails');
            
            if (businessName === 'all') {
                // Show overview of all businesses
                let html = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Total Businesses</h3>
                            <div class="value">3</div>
                            <div class="change">1 HCP Active</div>
                        </div>
                        <div class="stat-card green">
                            <h3>Combined Revenue (YTD)</h3>
                            <div class="value">$25,475.50</div>
                            <div class="change">All businesses</div>
                        </div>
                        <div class="stat-card blue">
                            <h3>Combined Profit (YTD)</h3>
                            <div class="value">$17,834.10</div>
                            <div class="change">Including HCP</div>
                        </div>
                        <div class="stat-card orange">
                            <h3>Average Margin</h3>
                            <div class="value">41.2%</div>
                            <div class="change">Across all businesses</div>
                        </div>
                    </div>
                `;
                
                html += `
                    <div class="card">
                        <h2>Business Performance Comparison</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Business</th>
                                    <th>Total Revenue</th>
                                    <th>Total Profit</th>
                                    <th>Packages</th>
                                    <th>Best Month</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Senor Bigote</strong> <span class="badge badge-info">HCP</span></td>
                                    <td>$15,022.00</td>
                                    <td>$8,545.20</td>
                                    <td>7,234</td>
                                    <td>July ($3,261.11)</td>
                                    <td><span class="badge badge-success">Growing</span></td>
                                </tr>
                                <tr>
                                    <td><strong>809 Restaurant</strong></td>
                                    <td>$7,940.50</td>
                                    <td>$3,176.20</td>
                                    <td>4,123</td>
                                    <td>July ($2,151.00)</td>
                                    <td><span class="badge badge-success">Stable</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Cana Stays</strong></td>
                                    <td>$2,513.00</td>
                                    <td>$1,005.20</td>
                                    <td>1,456</td>
                                    <td>July ($1,543.00)</td>
                                    <td><span class="badge badge-warning">New</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `;
                
                detailsDiv.innerHTML = html;
            } else {
                // Show specific business details
                const business = inwoodData.businesses.find(b => b.name === businessName);
                const businessPayments = inwoodData.amazonPayments.filter(p => p.business === businessName);
                const businessDeliveries = inwoodData.deliveries.filter(d => d.business === businessName);
                
                // Calculate totals
                const totalRevenue = businessPayments.reduce((sum, p) => sum + p.amount, 0);
                const totalPackages = businessDeliveries.length;
                const avgPackagesPerDay = (totalPackages / 228).toFixed(1); // Approx days YTD
                
                let html = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>${businessName}</h3>
                            <div class="value">${business.isHCP ? 'HCP Active' : 'Standard'}</div>
                            <div class="change">${business.isHCP ? `${business.hcpWeekly}/week since ${business.hcpStartDate}` : 'No HCP'}</div>
                        </div>
                        <div class="stat-card green">
                            <h3>Total Revenue (YTD)</h3>
                            <div class="value">${totalRevenue.toFixed(2)}</div>
                            <div class="change">From Amazon</div>
                        </div>
                        <div class="stat-card blue">
                            <h3>Total Packages</h3>
                            <div class="value">${totalPackages}</div>
                            <div class="change">${avgPackagesPerDay} per day avg</div>
                        </div>
                        <div class="stat-card orange">
                            <h3>Average Per Month</h3>
                            <div class="value">${(totalRevenue / 8).toFixed(2)}</div>
                            <div class="change">8 months data</div>
                        </div>
                    </div>
                `;
                
                html += `
                    <div class="card">
                        <h2>${businessName} - Monthly Performance</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Amazon Payment</th>
                                    <th>Est. Packages</th>
                                    <th>Est. Profit</th>
                                    <th>Trend</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                businessPayments.sort((a, b) => b.month.localeCompare(a.month)).forEach((payment, index) => {
                    const estPackages = Math.floor(payment.amount / 1.7); // Rough estimate
                    const estProfit = payment.amount * 0.4;
                    const prevPayment = businessPayments[index + 1];
                    let trend = '-';
                    
                    if (prevPayment) {
                        const change = ((payment.amount - prevPayment.amount) / prevPayment.amount * 100).toFixed(1);
                        trend = change > 0 ? 
                            `<span class="badge badge-success">↑ ${change}%</span>` : 
                            `<span class="badge badge-danger">↓ ${change}%</span>`;
                    }
                    
                    html += `
                        <tr>
                            <td>${payment.month}</td>
                            <td>${payment.amount.toFixed(2)}</td>
                            <td>~${estPackages}</td>
                            <td>${estProfit.toFixed(2)}</td>
                            <td>${trend}</td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                // Driver breakdown for this business
                const driverStats = {};
                businessDeliveries.forEach(d => {
                    if (!driverStats[d.driver]) {
                        driverStats[d.driver] = {packages: 0, days: new Set()};
                    }
                    driverStats[d.driver].packages += d.packages;
                    driverStats[d.driver].days.add(d.date);
                });
                
                html += `
                    <div class="card">
                        <h2>Driver Performance for ${businessName}</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Driver</th>
                                    <th>Total Packages</th>
                                    <th>Days Worked</th>
                                    <th>Avg/Day</th>
                                    <th>Earnings</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                Object.keys(driverStats).forEach(driver => {
                    const stats = driverStats[driver];
                    const avgPerDay = (stats.packages / stats.days.size).toFixed(1);
                    const earnings = stats.packages * 1.00;
                    
                    html += `
                        <tr>
                            <td>${driver}</td>
                            <td>${stats.packages}</td>
                            <td>${stats.days.size}</td>
                            <td>${avgPerDay}</td>
                            <td>${earnings.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                // Weekly breakdown for current month
                html += `
                    <div class="card">
                        <h2>August 2025 Weekly Breakdown - ${businessName}</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Week</th>
                                    <th>Packages</th>
                                    <th>Revenue</th>
                                    <th>Driver Cost</th>
                                    <th>Net Profit</th>
                                </tr>
                            </thead>
                            <tbody id="weeklyBreakdown">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                `;
                
                detailsDiv.innerHTML = html;
                
                // Calculate weekly breakdown
                const weeklyData = {};
                businessDeliveries.filter(d => d.date >= '2025-08-01').forEach(d => {
                    const week = getWeekNumber(d.date);
                    if (!weeklyData[week]) {
                        weeklyData[week] = {packages: 0, dates: new Set()};
                    }
                    weeklyData[week].packages += d.packages;
                    weeklyData[week].dates.add(d.date);
                });
                
                const weeklyBody = document.getElementById('weeklyBreakdown');
                Object.keys(weeklyData).forEach(week => {
                    const data = weeklyData[week];
                    const revenue = calculateAmazonPay(data.packages);
                    const driverCost = data.packages * 1.00;
                    const profit = revenue - driverCost;
                    
                    weeklyBody.innerHTML += `
                        <tr>
                            <td>Week ${week}</td>
                            <td>${data.packages}</td>
                            <td>${revenue.toFixed(2)}</td>
                            <td>${driverCost.toFixed(2)}</td>
                            <td style="color: #27ae60;">${profit.toFixed(2)}</td>
                        </tr>
                    `;
                });
            }
        }

        // Load quarterly report
        function loadQuarter(quarter) {
            document.querySelectorAll('#quarterly .period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const reportDiv = document.getElementById('quarterlyReport');
            let startMonth, endMonth, months;
            
            switch(quarter) {
                case 'Q1':
                    startMonth = '2025-01';
                    endMonth = '2025-03';
                    months = ['January', 'February', 'March'];
                    break;
                case 'Q2':
                    startMonth = '2025-04';
                    endMonth = '2025-06';
                    months = ['April', 'May', 'June'];
                    break;
                case 'Q3':
                    startMonth = '2025-07';
                    endMonth = '2025-09';
                    months = ['July', 'August', 'September'];
                    break;
                case 'Q4':
                    startMonth = '2025-10';
                    endMonth = '2025-12';
                    months = ['October', 'November', 'December'];
                    break;
            }
            
            // Get quarterly data
            const quarterPayments = inwoodData.amazonPayments.filter(p => 
                p.month >= startMonth && p.month <= endMonth
            );
            
            const totalRevenue = quarterPayments.reduce((sum, p) => sum + p.amount, 0);
            const estimatedCosts = totalRevenue * 0.6;
            const estimatedProfit = totalRevenue * 0.4;
            
            // Add HCP revenue for Q2 and Q3
            let hcpRevenue = 0;
            if (quarter === 'Q2') {
                hcpRevenue = 230.77 * 4; // June only (4 weeks)
            } else if (quarter === 'Q3') {
                hcpRevenue = 230.77 * 13; // Full quarter
            }
            
            const totalProfit = estimatedProfit + hcpRevenue;
            
            let html = `
                <div class="card">
                    <h2>${quarter} 2025 Summary (${months.join(', ')})</h2>
                    
                    <div class="stats-grid" style="margin-bottom: 20px;">
                        <div class="stat-card">
                            <h3>Gross Revenue</h3>
                            <div class="value">${totalRevenue.toFixed(2)}</div>
                            <div class="change">From Amazon</div>
                        </div>
                        <div class="stat-card">
                            <h3>Driver Costs</h3>
                            <div class="value">${estimatedCosts.toFixed(2)}</div>
                            <div class="change">~60% of revenue</div>
                        </div>
                        <div class="stat-card green">
                            <h3>Net Profit</h3>
                            <div class="value">${totalProfit.toFixed(2)}</div>
                            <div class="change">Including HCP</div>
                        </div>
                        <div class="stat-card blue">
                            <h3>Tax Estimate (25%)</h3>
                            <div class="value">${(totalProfit * 0.25).toFixed(2)}</div>
                            <div class="change">Set aside for taxes</div>
                        </div>
                    </div>
                    
                    <h3>Monthly Breakdown</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>809 Restaurant</th>
                                <th>Senor Bigote</th>
                                <th>Cana Stays</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // Group by month
            const monthlyData = {};
            quarterPayments.forEach(p => {
                if (!monthlyData[p.month]) {
                    monthlyData[p.month] = {};
                }
                monthlyData[p.month][p.business] = p.amount;
            });
            
            Object.keys(monthlyData).sort().forEach(month => {
                const data = monthlyData[month];
                const total = Object.values(data).reduce((sum, val) => sum + val, 0);
                
                html += `
                    <tr>
                        <td>${month}</td>
                        <td>${(data['809 Restaurant'] || 0).toFixed(2)}</td>
                        <td>${(data['Senor Bigote'] || 0).toFixed(2)}</td>
                        <td>${(data['Cana Stays'] || 0).toFixed(2)}</td>
                        <td><strong>${total.toFixed(2)}</strong></td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px;">
                        <h4>📋 Tax Filing Information</h4>
                        <div style="margin-top: 10px;">
                            <strong>Quarterly Estimated Tax Payment:</strong> ${(totalProfit * 0.25).toFixed(2)}<br>
                            <strong>Business Income:</strong> ${totalRevenue.toFixed(2)}<br>
                            <strong>Business Expenses (Drivers):</strong> ${estimatedCosts.toFixed(2)}<br>
                            ${hcpRevenue > 0 ? `<strong>HCP Income:</strong> ${hcpRevenue.toFixed(2)}<br>` : ''}
                            <strong>Net Business Income:</strong> ${totalProfit.toFixed(2)}
                        </div>
                    </div>
                </div>
            `;
            
            reportDiv.innerHTML = html;
        }

        // Load advanced analytics
        function loadAdvancedAnalytics() {
            // Calculate projections
            const last7Days = inwoodData.deliveries.filter(d => {
                const date = new Date(d.date);
                const weekAgo = new Date('2025-08-09');
                return date >= weekAgo;
            });
            
            const last30Days = inwoodData.deliveries.filter(d => {
                const date = new Date(d.date);
                const monthAgo = new Date('2025-07-17');
                return date >= monthAgo;
            });
            
            // Calculate daily averages
            const dailyAvg7 = (last7Days.length / 7) * 1.7 * 0.4; // packages * revenue * margin
            const dailyAvg30 = (last30Days.length / 30) * 1.7 * 0.4;
            
            document.getElementById('projection30').textContent = `${(dailyAvg7 * 30).toFixed(2)}`;
            document.getElementById('projection90').textContent = `${(dailyAvg30 * 90).toFixed(2)}`;
            document.getElementById('projectionYear').textContent = `${(dailyAvg30 * 365).toFixed(2)}`;
            
            // Load comparison matrix
            const matrixBody = document.getElementById('comparisonMatrix');
            matrixBody.innerHTML = `
                <tr>
                    <td><strong>Total Revenue (YTD)</strong></td>
                    <td>$15,022.00</td>
                    <td>$7,940.50</td>
                    <td>$2,513.00</td>
                </tr>
                <tr>
                    <td><strong>Average Monthly</strong></td>
                    <td>$1,877.75</td>
                    <td>$992.56</td>
                    <td>$628.25</td>
                </tr>
                <tr>
                    <td><strong>Best Month</strong></td>
                    <td>$3,261.11 (Jul)</td>
                    <td>$2,151.00 (Jul)</td>
                    <td>$1,543.00 (Jul)</td>
                </tr>
                <tr>
                    <td><strong>Growth Rate</strong></td>
                    <td><span class="badge badge-success">+18%</span></td>
                    <td><span class="badge badge-success">+12%</span></td>
                    <td><span class="badge badge-warning">New</span></td>
                </tr>
                <tr>
                    <td><strong>HCP Status</strong></td>
                    <td><span class="badge badge-info">Active</span></td>
                    <td>-</td>
                    <td>-</td>
                </tr>
            `;
            
            // Load growth analysis
            const growthBody = document.getElementById('growthAnalysis');
            const monthlyGrowth = [
                {period: 'Aug 2025', revenue: 3372.54, growth: -48.1, status: 'Partial Month'},
                {period: 'Jul 2025', revenue: 6955.11, growth: 13.2, status: 'Peak Month'},
                {period: 'Jun 2025', revenue: 6126.58, growth: 14.7, status: 'HCP Started'},
                {period: 'May 2025', revenue: 5338.27, growth: 17.8, status: 'Growing'},
                {period: 'Apr 2025', revenue: 4530.00, growth: 65.3, status: 'Strong Growth'},
                {period: 'Mar 2025', revenue: 2741.50, growth: 1440.7, status: 'Expansion'},
                {period: 'Feb 2025', revenue: 178.00, growth: 0, status: 'Started'}
            ];
            
            growthBody.innerHTML = '';
            monthlyGrowth.forEach(month => {
                const badge = month.growth > 0 ? 'badge-success' : month.growth < 0 ? 'badge-warning' : 'badge-info';
                growthBody.innerHTML += `
                    <tr>
                        <td>${month.period}</td>
                        <td>${month.revenue.toFixed(2)}</td>
                        <td><span class="badge ${badge}">${month.growth > 0 ? '+' : ''}${month.growth.toFixed(1)}%</span></td>
                        <td>${month.status}</td>
                    </tr>
                `;
            });
            
            // Load seasonal insights
            document.getElementById('seasonalInsights').innerHTML = `
                <h4>📊 Key Insights:</h4>
                <ul style="margin-top: 10px;">
                    <li><strong>Peak Performance:</strong> July 2025 was your best month with $6,955.11 in revenue</li>
                    <li><strong>HCP Impact:</strong> Since adding HCP to Senor Bigote (June 2), you've added $2,538.47 in pure profit</li>
                    <li><strong>Growth Trend:</strong> 18% average monthly growth since February</li>
                    <li><strong>Driver Efficiency:</strong> Jeuris handles 46.7% of all deliveries - consider backup coverage</li>
                    <li><strong>Opportunity:</strong> 809 Restaurant and Cana Stays could benefit from HCP status</li>
                    <li><strong>Risk:</strong> Heavy reliance on Senor Bigote (59% of revenue)</li>
                </ul>
                
                <h4 style="margin-top: 20px;">💡 Recommendations:</h4>
                <ul style="margin-top: 10px;">
                    <li>Consider adding HCP to 809 Restaurant for additional $1,000/month profit</li>
                    <li>Train backup driver for Jeuris's routes to avoid disruption</li>
                    <li>Focus on growing Cana Stays volume - highest profit margin at 41%</li>
                    <li>Set aside 25-30% of profits for quarterly tax payments</li>
                </ul>
            `;
            
            // Load profitability analysis
            const profitBody = document.getElementById('profitabilityAnalysis');
            profitBody.innerHTML = `
                <tr>
                    <td><strong>Senor Bigote</strong></td>
                    <td>$1.69</td>
                    <td>40.7%</td>
                    <td>$288.50</td>
                    <td><span class="badge badge-success">Maintain Volume</span></td>
                </tr>
                <tr>
                    <td><strong>809 Restaurant</strong></td>
                    <td>$1.69</td>
                    <td>40.7%</td>
                    <td>$152.50</td>
                    <td><span class="badge badge-info">Consider HCP</span></td>
                </tr>
                <tr>
                    <td><strong>Cana Stays</strong></td>
                    <td>$1.70</td>
                    <td>41.0%</td>
                    <td>$96.50</td>
                    <td><span class="badge badge-warning">Increase Volume</span></td>
                </tr>
            `;
        }

        // Helper function to get week number
        function getWeekNumber(dateStr) {
            const date = new Date(dateStr);
            const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
            return Math.ceil((date.getDate() + firstDay.getDay()) / 7);
        }

        // Load Amazon payments
        function loadAmazonPayments() {
            const tbody = document.getElementById('amazonPaymentsBody');
            tbody.innerHTML = '';
            
            inwoodData.amazonPayments.forEach(payment => {
                // Estimate expected based on 60% driver cost
                const expected = payment.amount;
                const driverCost = payment.amount * 0.6;
                const netProfit = payment.amount - driverCost;
                
                tbody.innerHTML += `
                    <tr>
                        <td>${payment.month}</td>
                        <td>${payment.business}</td>
                        <td>$${payment.amount.toFixed(2)}</td>
                        <td>$${expected.toFixed(2)}</td>
                        <td>$0.00</td>
                        <td><span class="badge badge-success">Received</span></td>
                    </tr>
                `;
            });
        }


        // Update YTD calculations with historical data
        function updateDashboardTotals() {
            // Calculate from historical Amazon payments
            let ytdRevenue = 0;
            let ytdCosts = 0;
            
            inwoodData.amazonPayments.forEach(payment => {
                ytdRevenue += payment.amount;
                ytdCosts += payment.amount * 0.6; // Estimate 60% driver cost
            });
            
            // Add HCP revenue (June 2 - Aug 16)
            const hcpStartDate = new Date('2025-06-02');
            const today = new Date('2025-08-16');
            const hcpDays = Math.floor((today - hcpStartDate) / (1000 * 60 * 60 * 24)) + 1;
            const hcpRevenue = (hcpDays / 7) * 230.77;
            
            const ytdProfit = (ytdRevenue - ytdCosts) + hcpRevenue;
            
            document.getElementById('ytdProfit').textContent = `$${ytdProfit.toFixed(2)}`;
        }
        
        // Update delivery dropdowns
        function updateDeliveryDropdowns() {
            const driverSelect = document.getElementById('deliveryDriver');
            driverSelect.innerHTML = '<option value="">Select Driver</option>' +
                inwoodData.drivers.map(driver => 
                    `<option value="${driver}">${driver}</option>`
                ).join('');
            
            const businessSelect = document.getElementById('deliveryBusiness');
            businessSelect.innerHTML = '<option value="">Select Business</option>' +
                inwoodData.businesses.map(business => 
                    `<option value="${business.name}">${business.name}${business.isHCP ? ' (HCP)' : ''}</option>`
                ).join('');
        }
        
        // Load settings
        function loadSettings() {
            const driversList = document.getElementById('driversList');
            driversList.innerHTML = inwoodData.drivers.map(driver => `
                <div style="padding: 10px; background: #f8f9fa; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
                    <span>${driver}</span>
                    <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="removeDriver('${driver}')">Remove</button>
                </div>
            `).join('');
            
            const businessList = document.getElementById('businessList');
            businessList.innerHTML = inwoodData.businesses.map(business => `
                <tr>
                    <td>${business.name}</td>
                    <td>${business.isHCP ? '<span class="badge badge-success">HCP Active</span>' : '<span class="badge badge-secondary">No HCP</span>'}</td>
                    <td>${business.isHCP ? `$${business.hcpWeekly.toFixed(2)}/week` : '-'}</td>
                    <td>
                        ${!business.isHCP ? 
                            `<button class="btn btn-success" style="padding: 5px 10px; font-size: 12px;" onclick="toggleHCP('${business.name}', true)">Make HCP</button>` :
                            `<button class="btn btn-warning" style="padding: 5px 10px; font-size: 12px;" onclick="toggleHCP('${business.name}', false)">Remove HCP</button>`
                        }
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px; margin-left: 5px;" onclick="removeBusiness('${business.name}')">Delete</button>
                    </td>
                </tr>
            `).join('');
            
            updateHCPSummary();
        }
        
        // Update HCP summary
        function updateHCPSummary() {
            const hcpBusinesses = inwoodData.businesses.filter(b => b.isHCP);
            const totalWeeklyHCP = hcpBusinesses.reduce((sum, b) => sum + b.hcpWeekly, 0);
            const monthlyHCP = totalWeeklyHCP * 4.33;
            const yearlyHCP = totalWeeklyHCP * 52;
            
            const hcpSummary = document.getElementById('hcpSummary');
            hcpSummary.innerHTML = `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <h4>Active HCP Businesses:</h4>
                    ${hcpBusinesses.length > 0 ? 
                        hcpBusinesses.map(b => `<div>• ${b.name}: $${b.hcpWeekly.toFixed(2)}/week (Started: ${b.hcpStartDate || 'N/A'})</div>`).join('') :
                        '<div>No HCP businesses active</div>'
                    }
                    <hr style="margin: 15px 0;">
                    <div><strong>Total Weekly HCP:</strong> $${totalWeeklyHCP.toFixed(2)}</div>
                    <div><strong>Estimated Monthly:</strong> $${monthlyHCP.toFixed(2)}</div>
                    <div><strong>Estimated Yearly:</strong> $${yearlyHCP.toFixed(2)}</div>
                </div>
            `;
        }

        // Set financial period
        function setPeriod(period) {
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateFinancialOverview(period);
        }

        // Update financial overview
        function updateFinancialOverview(period) {
            let startDate, endDate;
            const today = new Date('2025-08-16');
            
            switch(period) {
                case 'wtd':
                    startDate = new Date('2025-08-11');
                    endDate = new Date('2025-08-17');
                    break;
                case 'mtd':
                    startDate = new Date('2025-08-01');
                    endDate = new Date('2025-08-31');
                    break;
                case 'ytd':
                    startDate = new Date('2025-01-01');
                    endDate = new Date('2025-12-31');
                    break;
                case 'all':
                    startDate = new Date('2025-01-01');
                    endDate = new Date('2025-12-31');
                    break;
            }
            
            const periodDeliveries = inwoodData.deliveries.filter(d => {
                const date = new Date(d.date);
                return date >= startDate && date <= endDate;
            });
            
            let totalPackages = 0;
            let totalGross = 0;
            let totalCost = 0;
            
            // Group deliveries by date and business for proper daily calculation
            const dailyTotals = {};
            periodDeliveries.forEach(d => {
                const key = `${d.date}-${d.business}`;
                if (!dailyTotals[key]) {
                    dailyTotals[key] = {date: d.date, business: d.business, packages: 0};
                }
                dailyTotals[key].packages += d.packages;
                totalPackages += d.packages;
                totalCost += calculateDriverPay(d.packages);
            });
            
            // Calculate Amazon pay based on daily totals
            Object.values(dailyTotals).forEach(daily => {
                totalGross += calculateAmazonPay(daily.packages);
            });
            
            // Add historical data if needed
            if (period === 'ytd' || period === 'all') {
                const historicalRevenue = inwoodData.amazonPayments
                    .filter(p => p.month < '2025-08')
                    .reduce((sum, p) => sum + p.amount, 0);
                const historicalCosts = historicalRevenue * 0.6;
                
                totalGross += historicalRevenue;
                totalCost += historicalCosts;
            }
            
            // Add HCP revenue
            let hcpRevenue = 0;
            inwoodData.businesses.forEach(business => {
                if (business.isHCP) {
                    hcpRevenue += calculateHCPRevenue(business, startDate, endDate);
                }
            });
            
            const netProfit = totalGross - totalCost + hcpRevenue;
            const margin = totalGross > 0 ? ((netProfit / totalGross) * 100).toFixed(1) : 0;
            
            document.getElementById('grossRevenue').textContent = `$${totalGross.toFixed(2)}`;
            document.getElementById('totalCosts').textContent = `$${totalCost.toFixed(2)}`;
            document.getElementById('netProfit').textContent = `$${netProfit.toFixed(2)}`;
            document.getElementById('profitMargin').textContent = `${margin}%`;
            
            updateBusinessPerformanceTable(periodDeliveries);
            updateDriverEarningsTable(periodDeliveries);
            updateMonthlyTrend();
        }
        
        function updateBusinessPerformanceTable(deliveries) {
            const tbody = document.getElementById('businessPerformance');
            tbody.innerHTML = '';
            
            inwoodData.businesses.forEach(business => {
                const businessDeliveries = deliveries.filter(d => d.business === business.name);
                
                const dailyTotals = {};
                businessDeliveries.forEach(d => {
                    if (!dailyTotals[d.date]) {
                        dailyTotals[d.date] = 0;
                    }
                    dailyTotals[d.date] += d.packages;
                });
                
                let gross = 0;
                Object.values(dailyTotals).forEach(packages => {
                    gross += calculateAmazonPay(packages);
                });
                
                const costs = businessDeliveries.reduce((sum, d) => sum + calculateDriverPay(d.packages), 0);
                const net = gross - costs;
                const margin = gross > 0 ? ((net / gross) * 100).toFixed(1) : 0;
                
                tbody.innerHTML += `
                    <tr>
                        <td>${business.name}</td>
                        <td>$${gross.toFixed(2)}</td>
                        <td>$${net.toFixed(2)}</td>
                        <td>${margin}%</td>
                    </tr>
                `;
            });
        }
        
        function updateDriverEarningsTable(deliveries) {
            const tbody = document.getElementById('driverEarnings');
            tbody.innerHTML = '';
            
            inwoodData.drivers.forEach(driver => {
                const driverDeliveries = deliveries.filter(d => d.driver === driver);
                const packages = driverDeliveries.reduce((sum, d) => sum + d.packages, 0);
                const earnings = calculateDriverPay(packages);
                const daysWorked = new Set(driverDeliveries.map(d => d.date)).size;
                const avgPerDay = daysWorked > 0 ? (earnings / daysWorked).toFixed(2) : '0.00';
                
                tbody.innerHTML += `
                    <tr>
                        <td>${driver}</td>
                        <td>${packages}</td>
                        <td>$${earnings.toFixed(2)}</td>
                        <td>$${avgPerDay}</td>
                    </tr>
                `;
            });
        }

        function updateMonthlyTrend() {
            const tbody = document.getElementById('monthlyTrend');
            tbody.innerHTML = '';
            
            // Group Amazon payments by month
            const monthlyData = {};
            
            inwoodData.amazonPayments.forEach(payment => {
                if (!monthlyData[payment.month]) {
                    monthlyData[payment.month] = {
                        revenue: 0,
                        businesses: []
                    };
                }
                monthlyData[payment.month].revenue += payment.amount;
                monthlyData[payment.month].businesses.push(payment.business);
            });
            
            Object.keys(monthlyData).sort().reverse().forEach(month => {
                const data = monthlyData[month];
                const driverCosts = data.revenue * 0.6;
                const hcpRevenue = month >= '2025-06' ? 1000 : 0; // Estimate
                const netProfit = data.revenue - driverCosts + hcpRevenue;
                const margin = ((netProfit / data.revenue) * 100).toFixed(1);
                
                tbody.innerHTML += `
                    <tr>
                        <td>${month}</td>
                        <td>$${data.revenue.toFixed(2)}</td>
                        <td>$${driverCosts.toFixed(2)}</td>
                        <td>$${hcpRevenue.toFixed(2)}</td>
                        <td>$${netProfit.toFixed(2)}</td>
                        <td>${margin}%</td>
                    </tr>
                `;
            });
        }

        // Update preview
        document.getElementById('deliveryPackages').addEventListener('input', function() {
            const packages = parseInt(this.value) || 0;
            const amazon = calculateAmazonPay(packages);
            const driver = calculateDriverPay(packages);
            const profit = amazon - driver;
            
            document.getElementById('previewAmazon').textContent = amazon.toFixed(2);
            document.getElementById('previewDriver').textContent = driver.toFixed(2);
            document.getElementById('previewProfit').textContent = profit.toFixed(2);
        });

        // Add delivery
        function addDelivery() {
            const date = document.getElementById('deliveryDate').value;
            const driver = document.getElementById('deliveryDriver').value;
            const business = document.getElementById('deliveryBusiness').value;
            const packages = parseInt(document.getElementById('deliveryPackages').value);
            const notes = document.getElementById('deliveryNotes').value;
            
            if (!date || !driver || !business || !packages) {
                alert('Please fill all required fields');
                return;
            }
            
            inwoodData.deliveries.push({date, driver, business, packages, notes});
            saveData();
            clearForm();
            loadRecentEntries();
            updateDashboardTotals();
            alert('Delivery added successfully!');
        }

        // Clear form
        function clearForm() {
            document.getElementById('deliveryDriver').value = '';
            document.getElementById('deliveryBusiness').value = '';
            document.getElementById('deliveryPackages').value = '';
            document.getElementById('deliveryNotes').value = '';
            document.getElementById('previewAmazon').textContent = '0.00';
            document.getElementById('previewDriver').textContent = '0.00';
            document.getElementById('previewProfit').textContent = '0.00';
        }

        // Load recent entries
        function loadRecentEntries() {
            const tbody = document.getElementById('recentEntries');
            const recent = inwoodData.deliveries.slice(-10).reverse();
            
            tbody.innerHTML = recent.map((d, i) => {
                const amazon = calculateAmazonPay(d.packages);
                const driver = calculateDriverPay(d.packages);
                const profit = amazon - driver;
                
                return `
                    <tr>
                        <td>${d.date}</td>
                        <td>${d.driver}</td>
                        <td>${d.business}</td>
                        <td>${d.packages}</td>
                        <td>$${amazon.toFixed(2)}</td>
                        <td>$${driver.toFixed(2)}</td>
                        <td style="color: #27ae60;">$${profit.toFixed(2)}</td>
                        <td><button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteEntry(${inwoodData.deliveries.length - 10 + i})">Delete</button></td>
                    </tr>
                `;
            }).join('');
        }

        // Delete entry
        function deleteEntry(index) {
            if (confirm('Delete this entry?')) {
                inwoodData.deliveries.splice(index, 1);
                saveData();
                loadRecentEntries();
                updateDashboardTotals();
            }
        }

        // Load week for payouts
        function loadWeek() {
            const weekValue = document.getElementById('payoutWeek').value;
            if (!weekValue) return;
            
            const [year, week] = weekValue.split('-W');
            const firstDay = new Date(year, 0, (week - 1) * 7 + 1);
            const lastDay = new Date(firstDay);
            lastDay.setDate(lastDay.getDate() + 6);
            
            const weekDeliveries = inwoodData.deliveries.filter(d => {
                const date = new Date(d.date);
                return date >= firstDay && date <= lastDay;
            });
            
            const tbody = document.getElementById('payoutBody');
            tbody.innerHTML = '';
            
            const totals = {};
            inwoodData.drivers.forEach(driver => {
                totals[driver] = 0;
            });
            
            const weekPayments = inwoodData.payments.filter(p => p.week === weekValue);
            const paidDrivers = {};
            weekPayments.forEach(p => {
                paidDrivers[p.driver] = true;
            });
            
            weekDeliveries.forEach(d => {
                const amount = calculateDriverPay(d.packages);
                if (totals[d.driver] !== undefined) {
                    totals[d.driver] += amount;
                }
                
                const isPaid = paidDrivers[d.driver] || false;
                
                tbody.innerHTML += `
                    <tr>
                        <td>${d.date}</td>
                        <td>${d.driver}</td>
                        <td>${d.business}</td>
                        <td>${d.packages}</td>
                        <td>$${amount.toFixed(2)}</td>
                        <td>${isPaid ? '<span class="badge badge-success">Paid</span>' : '<span class="badge badge-warning">Pending</span>'}</td>
                    </tr>
                `;
            });
            
            // Update week totals
            const weekTotalsDiv = document.getElementById('weekTotalsDiv');
            weekTotalsDiv.innerHTML = '';
            let weekTotal = 0;
            
            Object.keys(totals).forEach(driver => {
                weekTotal += totals[driver];
                weekTotalsDiv.innerHTML += `
                    <div>
                        <strong>${driver}:</strong> $${totals[driver].toFixed(2)}
                    </div>
                `;
            });
            
            weekTotalsDiv.innerHTML += `
                <div>
                    <strong>TOTAL:</strong> $${weekTotal.toFixed(2)}
                </div>
            `;
        }

        // Quick actions
        function quickAddDelivery() {
            switchTab('deliveries');
        }

        function exportData() {
            const dataStr = JSON.stringify(inwoodData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `inwood-logistics-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function backupData() {
            exportData();
            alert('Data backed up successfully!');
        }

        function showNotifications() {
            alert('2 Notifications:
1. Gabriel payment pending: $162
2. Rafa JR payment pending: $153');
        }

        function markPaid(driver, amount) {
            const week = '2025-W33';
            
            const existingPayment = inwoodData.payments.find(p => 
                p.week === week && p.driver === driver
            );
            
            if (!existingPayment) {
                inwoodData.payments.push({
                    week: week,
                    driver: driver,
                    amount: amount,
                    paid: true,
                    date: new Date().toISOString().split('T')[0]
                });
                saveData();
                alert(`${driver} marked as paid!`);
                location.reload();
            }
        }

        // Update validation dates based on type
        function updateValidationDates() {
            const type = document.getElementById('validationType').value;
            const today = new Date('2025-08-16');
            let startDate, endDate;
            
            if (type === 'amazon') {
                // Last complete Amazon week (Sunday-Saturday)
                const lastSaturday = new Date(today);
                lastSaturday.setDate(today.getDate() - (today.getDay() + 1));
                const lastSunday = new Date(lastSaturday);
                lastSunday.setDate(lastSaturday.getDate() - 6);
                
                document.getElementById('validStart').value = lastSunday.toISOString().split('T')[0];
                document.getElementById('validEnd').value = lastSaturday.toISOString().split('T')[0];
            } else if (type === 'business') {
                // Last complete business week (Monday-Sunday)
                const lastSunday = new Date(today);
                lastSunday.setDate(today.getDate() - (today.getDay() || 7));
                const lastMonday = new Date(lastSunday);
                lastMonday.setDate(lastSunday.getDate() - 6);
                
                document.getElementById('validStart').value = lastMonday.toISOString().split('T')[0];
                document.getElementById('validEnd').value = lastSunday.toISOString().split('T')[0];
            }
        }

        // Quick validate last Amazon week
        function quickValidateLastWeek() {
            document.getElementById('validationType').value = 'amazon';
            updateValidationDates();
            validatePayment();
        }

        // Validate payment with week offset handling
        function validatePayment() {
            const start = document.getElementById('validStart').value;
            const end = document.getElementById('validEnd').value;
            const amazonAmount = parseFloat(document.getElementById('amazonPaymentAmount').value) || 0;
            
            if (!start || !end) {
                alert('Please select both dates');
                return;
            }
            
            const rangeDeliveries = inwoodData.deliveries.filter(d => {
                return d.date >= start && d.date <= end;
            });
            
            // Check if this is an Amazon week (Sunday start)
            const startDay = new Date(start).getDay();
            const isAmazonWeek = startDay === 0;
            
            const byBusiness = {};
            const byDay = {};
            let totalPackages = 0;
            let totalAmazon = 0;
            let totalDriver = 0;
            
            // Group by date and business for accurate calculation
            const dailyBusinessTotals = {};
            
            rangeDeliveries.forEach(d => {
                const key = `${d.date}-${d.business}`;
                if (!dailyBusinessTotals[key]) {
                    dailyBusinessTotals[key] = {
                        date: d.date,
                        business: d.business,
                        packages: 0
                    };
                }
                dailyBusinessTotals[key].packages += d.packages;
                
                if (!byBusiness[d.business]) {
                    byBusiness[d.business] = {packages: 0, amazon: 0, driver: 0};
                }
                byBusiness[d.business].packages += d.packages;
                byBusiness[d.business].driver += calculateDriverPay(d.packages);
                
                if (!byDay[d.date]) {
                    byDay[d.date] = 0;
                }
                byDay[d.date] += d.packages;
                
                totalPackages += d.packages;
                totalDriver += calculateDriverPay(d.packages);
            });
            
            // Calculate Amazon payment based on daily totals
            Object.values(dailyBusinessTotals).forEach(daily => {
                const amazonPay = calculateAmazonPay(daily.packages);
                byBusiness[daily.business].amazon += amazonPay;
                totalAmazon += amazonPay;
            });
            
            let html = `
                <h3>Validation Results: ${start} to ${end}</h3>
                ${isAmazonWeek ? 
                    '<span class="badge badge-info">Amazon Week (Sun-Sat)</span>' : 
                    '<span class="badge badge-warning">Business Week (Mon-Sun)</span>'}
                
                <div style="margin-top: 15px;">
                    <h4>Daily Breakdown:</h4>
                    <table style="width: 100%; margin-top: 10px;">
                        <tr>
                            <th>Date</th>
                            <th>Day</th>
                            <th>Packages</th>
                            <th>Revenue</th>
                        </tr>
            `;
            
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            Object.keys(byDay).sort().forEach(date => {
                const dayNum = new Date(date).getDay();
                const revenue = calculateAmazonPay(byDay[date]);
                const highlight = (isAmazonWeek && dayNum === 0) || (!isAmazonWeek && dayNum === 1) ? 
                    'style="background: #e3f2fd;"' : '';
                
                html += `
                    <tr ${highlight}>
                        <td>${date}</td>
                        <td>${days[dayNum]}</td>
                        <td>${byDay[date]}</td>
                        <td>${revenue.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            html += `
                    </table>
                </div>
                
                <div style="margin-top: 15px;">
                    <h4>Business Breakdown:</h4>
                    <table style="width: 100%; margin-top: 10px;">
                        <tr>
                            <th>Business</th>
                            <th>Packages</th>
                            <th>Amazon Owes</th>
                        </tr>
            `;
            
            Object.keys(byBusiness).forEach(business => {
                html += `
                    <tr>
                        <td>${business}</td>
                        <td>${byBusiness[business].packages}</td>
                        <td>${byBusiness[business].amazon.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            html += `
                    <tr style="font-weight: bold; background: #f8f9fa;">
                        <td>TOTAL</td>
                        <td>${totalPackages}</td>
                        <td>${totalAmazon.toFixed(2)}</td>
                    </tr>
                </table>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: ${amazonAmount > 0 ? 
                    (Math.abs(amazonAmount - totalAmazon) < 1 ? '#d4edda' : '#f8d7da') : 
                    '#e3f2fd'}; border-radius: 8px;">
                    <h4>Payment Summary:</h4>
                    <strong>Amazon should pay you: ${totalAmazon.toFixed(2)}</strong><br>
            `;
            
            if (amazonAmount > 0) {
                const difference = amazonAmount - totalAmazon;
                html += `
                    <strong>Amazon actually paid: ${amazonAmount.toFixed(2)}</strong><br>
                    <strong>Difference: ${difference >= 0 ? '+' : ''}${difference.toFixed(2)}</strong>
                    ${Math.abs(difference) < 1 ? 
                        ' ✅ <span style="color: green;">Payment matches!</span>' : 
                        ` ⚠️ <span style="color: red;">Discrepancy of ${Math.abs(difference).toFixed(2)}</span>`}
                `;
            }
            
            html += `
                    <br><br>
                    <strong>You pay drivers: ${totalDriver.toFixed(2)}</strong><br>
                    <strong>Your profit: ${(totalAmazon - totalDriver).toFixed(2)}</strong>
                </div>
                
                ${!isAmazonWeek ? `
                <div class="alert alert-warning" style="margin-top: 15px;">
                    <strong>Note:</strong> This is YOUR business week (Mon-Sun). Amazon pays on THEIR week (Sun-Sat), 
                    so Sunday's packages may be paid in the previous Amazon payment.
                </div>` : ''}
            `;
            
            document.getElementById('validationResult').innerHTML = html;
            document.getElementById('validationResult').style.display = 'block';
        }

        // Export week to CSV
        function exportWeek() {
            const weekValue = document.getElementById('payoutWeek').value;
            if (!weekValue) {
                alert('Please select a week first');
                return;
            }
            
            const [year, week] = weekValue.split('-W');
            const firstDay = new Date(year, 0, (week - 1) * 7 + 1);
            const lastDay = new Date(firstDay);
            lastDay.setDate(lastDay.getDate() + 6);
            
            const weekDeliveries = inwoodData.deliveries.filter(d => {
                const date = new Date(d.date);
                return date >= firstDay && date <= lastDay;
            });
            
            let csv = 'Date,Driver,Business,Packages,Amount
';
            
            weekDeliveries.forEach(d => {
                const amount = calculateDriverPay(d.packages);
                csv += `${d.date},${d.driver},${d.business},${d.packages},${amount}
`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `week-${weekValue}-payouts.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Mark all paid
        function markAllPaid() {
            const weekValue = document.getElementById('payoutWeek').value;
            if (!weekValue) {
                alert('Please select a week first');
                return;
            }
            
            const [year, week] = weekValue.split('-W');
            const firstDay = new Date(year, 0, (week - 1) * 7 + 1);
            const lastDay = new Date(firstDay);
            lastDay.setDate(lastDay.getDate() + 6);
            
            const weekDeliveries = inwoodData.deliveries.filter(d => {
                const date = new Date(d.date);
                return date >= firstDay && date <= lastDay;
            });
            
            const driverTotals = {};
            weekDeliveries.forEach(d => {
                if (!driverTotals[d.driver]) {
                    driverTotals[d.driver] = 0;
                }
                driverTotals[d.driver] += calculateDriverPay(d.packages);
            });
            
            Object.keys(driverTotals).forEach(driver => {
                if (driverTotals[driver] > 0) {
                    const existingPayment = inwoodData.payments.find(p => 
                        p.week === weekValue && p.driver === driver
                    );
                    
                    if (!existingPayment) {
                        inwoodData.payments.push({
                            week: weekValue,
                            driver: driver,
                            amount: driverTotals[driver],
                            paid: true,
                            date: new Date().toISOString().split('T')[0]
                        });
                    }
                }
            });
            
            saveData();
            loadWeek();
            alert('All drivers marked as paid for this week!');
        }


        // Driver and business management
        function addDriver() {
            const newDriver = document.getElementById('newDriverName').value.trim();
            if (!newDriver) {
                alert('Please enter a driver name');
                return;
            }
            
            if (inwoodData.drivers.includes(newDriver)) {
                alert('This driver already exists');
                return;
            }
            
            inwoodData.drivers.push(newDriver);
            saveData();
            document.getElementById('newDriverName').value = '';
            loadSettings();
            alert(`Driver "${newDriver}" added successfully!`);
        }
        
        function removeDriver(driver) {
            if (!confirm(`Are you sure you want to remove ${driver}? Their delivery history will be kept.`)) {
                return;
            }
            
            inwoodData.drivers = inwoodData.drivers.filter(d => d !== driver);
            saveData();
            loadSettings();
        }
        
        function addBusiness() {
            const newBusiness = document.getElementById('newBusinessName').value.trim();
            const isHCP = document.getElementById('newBusinessHCP').value === 'yes';
            
            if (!newBusiness) {
                alert('Please enter a business name');
                return;
            }
            
            if (inwoodData.businesses.some(b => b.name === newBusiness)) {
                alert('This business already exists');
                return;
            }
            
            inwoodData.businesses.push({
                name: newBusiness,
                isHCP: isHCP,
                hcpWeekly: isHCP ? 230.77 : 0,
                hcpStartDate: isHCP ? new Date().toISOString().split('T')[0] : null
            });
            
            saveData();
            document.getElementById('newBusinessName').value = '';
            document.getElementById('newBusinessHCP').value = 'no';
            loadSettings();
            alert(`Business "${newBusiness}" added successfully!${isHCP ? ' (HCP Active)' : ''}`);
        }
        
        function removeBusiness(business) {
            if (!confirm(`Are you sure you want to remove ${business}? Their delivery history will be kept.`)) {
                return;
            }
            
            inwoodData.businesses = inwoodData.businesses.filter(b => b.name !== business);
            saveData();
            loadSettings();
        }
        
        function toggleHCP(businessName, makeHCP) {
            const business = inwoodData.businesses.find(b => b.name === businessName);
            if (!business) return;
            
            if (makeHCP) {
                const customAmount = prompt('Enter weekly HCP amount (or leave empty for default $230.77):');
                const amount = customAmount ? parseFloat(customAmount) : 230.77;
                
                business.isHCP = true;
                business.hcpWeekly = amount;
                business.hcpStartDate = new Date().toISOString().split('T')[0];
                alert(`${businessName} is now an HCP business receiving $${amount.toFixed(2)}/week`);
            } else {
                business.isHCP = false;
                business.hcpWeekly = 0;
                business.hcpStartDate = null;
                alert(`${businessName} is no longer an HCP business`);
            }
            
            saveData();
            loadSettings();
            updateDashboardTotals();
        }

        // Export all data
        function exportAllData() {
            exportData();
        }

        // Clear all data
        function clearAllData() {
            if (confirm('
