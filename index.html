<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Hub Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #2d3748;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            color: #718096;
            font-size: 14px;
        }

        .nav-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: #4a5568;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #718096;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card .value {
            color: #2d3748;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-card .change {
            font-size: 14px;
            color: #48bb78;
        }

        .stat-card .change.negative {
            color: #f56565;
        }

        .form-card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: #4a5568;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 32px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            margin-left: 12px;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .data-table {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .table-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            font-size: 16px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 16px;
            background: #f7fafc;
            color: #4a5568;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e2e8f0;
        }

        td {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
            color: #2d3748;
            font-size: 14px;
        }

        tr:hover {
            background: #f7fafc;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-btn.edit {
            background: #4299e1;
            color: white;
        }

        .action-btn.delete {
            background: #f56565;
            color: white;
            margin-left: 8px;
        }

        .summary-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-item {
            padding: 16px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .summary-item h4 {
            color: #4a5568;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .summary-item .amount {
            color: #2d3748;
            font-size: 24px;
            font-weight: bold;
        }

        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .alert-success {
            background: #c6f6d5;
            color: #22543d;
            border-left: 4px solid #48bb78;
        }

        .alert-info {
            background: #bee3f8;
            color: #2c5282;
            border-left: 4px solid #4299e1;
        }

        .export-section {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöö Amazon Hub Management System</h1>
            <p>Track deliveries, manage drivers, and maximize profits across all businesses</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="switchTab('daily-entry')">üìù Daily Entry</button>
            <button class="nav-tab" onclick="switchTab('weekly-payouts')">üí∞ Weekly Payouts</button>
            <button class="nav-tab" onclick="switchTab('business-summary')">üè¢ Business Summary</button>
            <button class="nav-tab" onclick="switchTab('reports')">üìà Reports</button>
            <button class="nav-tab" onclick="switchTab('settings')">‚öôÔ∏è Settings</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="stat-card">
                    <h3>Today's Profit</h3>
                    <div class="value" id="todayProfit">$0.00</div>
                    <div class="change">+12% from yesterday</div>
                </div>
                <div class="stat-card">
                    <h3>This Week's Total</h3>
                    <div class="value" id="weekTotal">$0.00</div>
                    <div class="change">+8% from last week</div>
                </div>
                <div class="stat-card">
                    <h3>Packages Today</h3>
                    <div class="value" id="packagesToday">0</div>
                    <div class="change">Across all businesses</div>
                </div>
                <div class="stat-card">
                    <h3>Driver Payments Due</h3>
                    <div class="value" id="paymentsdue">$0.00</div>
                    <div class="change negative">4 drivers pending</div>
                </div>
            </div>

            <div class="data-table">
                <div class="table-header">Recent Deliveries</div>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Driver</th>
                            <th>Business</th>
                            <th>Packages</th>
                            <th>Amazon Pay</th>
                            <th>Driver Pay</th>
                            <th>Your Profit</th>
                        </tr>
                    </thead>
                    <tbody id="recentDeliveries">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Daily Entry Tab -->
        <div id="daily-entry" class="tab-content">
            <div class="form-card">
                <h2 style="margin-bottom: 24px; color: #2d3748;">Add Daily Delivery</h2>
                
                <div id="entryAlert" class="alert alert-success" style="display: none;">
                    ‚úÖ Entry added successfully!
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="entryDate" value="">
                    </div>
                    <div class="form-group">
                        <label>Driver</label>
                        <select id="entryDriver">
                            <option value="">Select Driver</option>
                            <option value="Gabriel">Gabriel</option>
                            <option value="Rafa JR">Rafa JR</option>
                            <option value="Jeuris">Jeuris</option>
                            <option value="Jamel">Jamel</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Business</label>
                        <select id="entryBusiness">
                            <option value="">Select Business</option>
                            <option value="Senor Bigote">Senor Bigote Barberia</option>
                            <option value="Cana Stays">Cana Stays</option>
                            <option value="809 Restaurant">809 Restaurant</option>
                            <option value="101 Pescaderia">101 Pescaderia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Packages</label>
                        <input type="number" id="entryPackages" placeholder="0" min="0">
                    </div>
                </div>

                <div class="summary-section" style="background: #f7fafc;">
                    <h3 style="margin-bottom: 16px; color: #4a5568;">Instant Calculation</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <h4>Amazon Pays You</h4>
                            <div class="amount" id="previewAmazon">$0.00</div>
                        </div>
                        <div class="summary-item">
                            <h4>You Pay Driver</h4>
                            <div class="amount" id="previewDriver">$0.00</div>
                        </div>
                        <div class="summary-item">
                            <h4>Your Profit</h4>
                            <div class="amount" id="previewProfit">$0.00</div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 24px;">
                    <button class="btn btn-primary" onclick="addEntry()">Add Entry</button>
                    <button class="btn btn-secondary" onclick="clearEntryForm()">Clear</button>
                </div>
            </div>

            <div class="data-table">
                <div class="table-header">Today's Entries</div>
                <table>
                    <thead>
                        <tr>
                            <th>Driver</th>
                            <th>Business</th>
                            <th>Packages</th>
                            <th>Amazon Pay</th>
                            <th>Driver Pay</th>
                            <th>Profit</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="todayEntries">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Weekly Payouts Tab -->
        <div id="weekly-payouts" class="tab-content">
            <div class="summary-section">
                <h2 style="margin-bottom: 24px; color: #2d3748;">Weekly Driver Payouts</h2>
                
                <div class="form-grid" style="margin-bottom: 24px;">
                    <div class="form-group">
                        <label>Select Week</label>
                        <input type="week" id="payoutWeek" onchange="updatePayouts()">
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">Driver Earnings by Business</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Driver</th>
                                <th>Business</th>
                                <th>Packages</th>
                                <th>Amount Owed</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="driverPayouts">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <div class="summary-grid" style="margin-top: 24px;">
                    <div class="summary-item">
                        <h4>Gabriel Total</h4>
                        <div class="amount" id="gabrielTotal">$0.00</div>
                    </div>
                    <div class="summary-item">
                        <h4>Rafa JR Total</h4>
                        <div class="amount" id="rafaTotal">$0.00</div>
                    </div>
                    <div class="summary-item">
                        <h4>Jeuris Total</h4>
                        <div class="amount" id="jeurisTotal">$0.00</div>
                    </div>
                    <div class="summary-item">
                        <h4>Jamel Total</h4>
                        <div class="amount" id="jamelTotal">$0.00</div>
                    </div>
                </div>

                <div class="export-section">
                    <button class="btn btn-primary" onclick="exportPayouts()">Export to CSV</button>
                    <button class="btn btn-secondary" onclick="markAllPaid()">Mark All Paid</button>
                </div>
            </div>
        </div>

        <!-- Business Summary Tab -->
        <div id="business-summary" class="tab-content">
            <div class="dashboard-grid">
                <div class="stat-card">
                    <h3>Senor Bigote Barberia</h3>
                    <div class="value" id="sbProfit">$0.00</div>
                    <div class="change">This week + HCP $230.77</div>
                </div>
                <div class="stat-card">
                    <h3>Cana Stays</h3>
                    <div class="value" id="csProfit">$0.00</div>
                    <div class="change">This week</div>
                </div>
                <div class="stat-card">
                    <h3>809 Restaurant</h3>
                    <div class="value" id="r809Profit">$0.00</div>
                    <div class="change">This week</div>
                </div>
                <div class="stat-card">
                    <h3>101 Pescaderia</h3>
                    <div class="value" id="p101Profit">$0.00</div>
                    <div class="change">This week</div>
                </div>
            </div>

            <div class="data-table">
                <div class="table-header">Business Performance This Week</div>
                <table>
                    <thead>
                        <tr>
                            <th>Business</th>
                            <th>Total Packages</th>
                            <th>Amazon Revenue</th>
                            <th>Driver Costs</th>
                            <th>Net Profit</th>
                            <th>Profit Margin</th>
                        </tr>
                    </thead>
                    <tbody id="businessPerformance">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="form-card">
                <h2 style="margin-bottom: 24px; color: #2d3748;">Generate Reports</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Report Type</label>
                        <select id="reportType">
                            <option value="weekly">Weekly Summary</option>
                            <option value="monthly">Monthly Summary</option>
                            <option value="driver">Driver Performance</option>
                            <option value="business">Business Analysis</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Date Range</label>
                        <input type="date" id="reportStartDate">
                    </div>
                    <div class="form-group">
                        <label>To</label>
                        <input type="date" id="reportEndDate">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="generateReport()">Generate Report</button>
            </div>

            <div id="reportContent" class="summary-section" style="display: none;">
                <!-- Report content will be populated here -->
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="form-card">
                <h2 style="margin-bottom: 24px; color: #2d3748;">System Settings</h2>
                
                <div class="summary-section" style="background: #f7fafc;">
                    <h3 style="margin-bottom: 16px; color: #4a5568;">Payment Rates</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Amazon Rate (First 25)</label>
                            <input type="number" id="amazonRate1" value="2.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Amazon Rate (26+)</label>
                            <input type="number" id="amazonRate2" value="1.50" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Driver Rate</label>
                            <input type="number" id="driverRate" value="1.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>HCP Weekly Payment</label>
                            <input type="number" id="hcpPayment" value="230.77" step="0.01">
                        </div>
                    </div>
                </div>

                <div class="summary-section" style="background: #f7fafc; margin-top: 20px;">
                    <h3 style="margin-bottom: 16px; color: #4a5568;">Add New Driver</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Driver Name</label>
                            <input type="text" id="newDriverName" placeholder="Enter driver name">
                        </div>
                        <div class="form-group" style="display: flex; align-items: flex-end;">
                            <button class="btn btn-primary" onclick="addDriver()">Add Driver</button>
                        </div>
                    </div>
                </div>

                <div class="summary-section" style="background: #f7fafc; margin-top: 20px;">
                    <h3 style="margin-bottom: 16px; color: #4a5568;">Add New Business</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Business Name</label>
                            <input type="text" id="newBusinessName" placeholder="Enter business name">
                        </div>
                        <div class="form-group" style="display: flex; align-items: flex-end;">
                            <button class="btn btn-primary" onclick="addBusiness()">Add Business</button>
                        </div>
                    </div>
                </div>

                <div class="export-section">
                    <button class="btn btn-primary" onclick="exportAllData()">Export All Data</button>
                    <button class="btn btn-secondary" onclick="importData()">Import Data</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize data structure
        let amazonHubData = {
            entries: [],
            drivers: ['Gabriel', 'Rafa JR', 'Jeuris', 'Jamel'],
            businesses: ['Senor Bigote', 'Cana Stays', '809 Restaurant', '101 Pescaderia'],
            settings: {
                amazonRate1: 2.00,
                amazonRate2: 1.50,
                driverRate: 1.00,
                hcpWeekly: 230.77
            }
        };

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('amazonHubData');
            if (saved) {
                amazonHubData = JSON.parse(saved);
            }
            updateAllDisplays();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('amazonHubData', JSON.stringify(amazonHubData));
        }

        // Switch tabs
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            // Remove active from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            // Add active to clicked nav tab
            event.target.classList.add('active');
            
            // Update displays based on tab
            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'weekly-payouts') {
                updatePayouts();
            } else if (tabName === 'business-summary') {
                updateBusinessSummary();
            }
        }

        // Calculate Amazon payment
        function calculateAmazonPay(packages, business) {
            const rate1 = amazonHubData.settings.amazonRate1;
            const rate2 = amazonHubData.settings.amazonRate2;
            
            if (packages <= 25) {
                return packages * rate1;
            } else {
                return (25 * rate1) + ((packages - 25) * rate2);
            }
        }

        // Calculate driver payment
        function calculateDriverPay(packages) {
            return packages * amazonHubData.settings.driverRate;
        }

        // Update preview calculations
        function updatePreview() {
            const packages = parseInt(document.getElementById('entryPackages').value) || 0;
            const business = document.getElementById('entryBusiness').value;
            
            const amazonPay = calculateAmazonPay(packages, business);
            const driverPay = calculateDriverPay(packages);
            const profit = amazonPay - driverPay;
            
            document.getElementById('previewAmazon').textContent = `$${amazonPay.toFixed(2)}`;
            document.getElementById('previewDriver').textContent = `$${driverPay.toFixed(2)}`;
            document.getElementById('previewProfit').textContent = `$${profit.toFixed(2)}`;
        }

        // Add entry
        function addEntry() {
            const date = document.getElementById('entryDate').value;
            const driver = document.getElementById('entryDriver').value;
            const business = document.getElementById('entryBusiness').value;
            const packages = parseInt(document.getElementById('entryPackages').value);
            
            if (!date || !driver || !business || !packages) {
                alert('Please fill in all fields');
                return;
            }
            
            const amazonPay = calculateAmazonPay(packages, business);
            const driverPay = calculateDriverPay(packages);
            const profit = amazonPay - driverPay;
            
            const entry = {
                id: Date.now(),
                date,
                driver,
                business,
                packages,
                amazonPay,
                driverPay,
                profit
            };
            
            amazonHubData.entries.push(entry);
            saveData();
            
            // Show success alert
            document.getElementById('entryAlert').style.display = 'block';
            setTimeout(() => {
                document.getElementById('entryAlert').style.display = 'none';
            }, 3000);
            
            clearEntryForm();
            updateAllDisplays();
        }

        // Clear entry form
        function clearEntryForm() {
            document.getElementById('entryDriver').value = '';
            document.getElementById('entryBusiness').value = '';
            document.getElementById('entryPackages').value = '';
            updatePreview();
        }

        // Update dashboard
        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const todayEntries = amazonHubData.entries.filter(e => e.date === today);
            
            // Calculate today's totals
            const todayProfit = todayEntries.reduce((sum, e) => sum + e.profit, 0);
            const todayPackages = todayEntries.reduce((sum, e) => sum + e.packages, 0);
            
            document.getElementById('todayProfit').textContent = `$${todayProfit.toFixed(2)}`;
            document.getElementById('packagesToday').textContent = todayPackages;
            
            // Calculate week totals
            const weekStart = getWeekStart(new Date());
            const weekEntries = amazonHubData.entries.filter(e => {
                const entryDate = new Date(e.date);
                return entryDate >= weekStart;
            });
            
            const weekTotal = weekEntries.reduce((sum, e) => sum + e.profit, 0);
            document.getElementById('weekTotal').textContent = `$${weekTotal.toFixed(2)}`;
            
            // Calculate pending payments
            const pendingPayments = weekEntries.reduce((sum, e) => sum + e.driverPay, 0);
            document.getElementById('paymentsdue').textContent = `$${pendingPayments.toFixed(2)}`;
            
            // Update recent deliveries table
            const recentEntries = amazonHubData.entries.slice(-10).reverse();
            const tbody = document.getElementById('recentDeliveries');
            tbody.innerHTML = recentEntries.map(entry => `
                <tr>
                    <td>${entry.date}</td>
                    <td>${entry.driver}</td>
                    <td>${entry.business}</td>
                    <td>${entry.packages}</td>
                    <td>$${entry.amazonPay.toFixed(2)}</td>
                    <td>$${entry.driverPay.toFixed(2)}</td>
                    <td>$${entry.profit.toFixed(2)}</td>
                </tr>
            `).join('');
            
            // Update today's entries
            const todayTbody = document.getElementById('todayEntries');
            todayTbody.innerHTML = todayEntries.map(entry => `
                <tr>
                    <td>${entry.driver}</td>
                    <td>${entry.business}</td>
                    <td>${entry.packages}</td>
                    <td>$${entry.amazonPay.toFixed(2)}</td>
                    <td>$${entry.driverPay.toFixed(2)}</td>
                    <td>$${entry.profit.toFixed(2)}</td>
                    <td>
                        <button class="action-btn delete" onclick="deleteEntry(${entry.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        // Update weekly payouts
        function updatePayouts() {
            const weekValue = document.getElementById('payoutWeek').value;
            if (!weekValue) return;
            
            const [year, week] = weekValue.split('-W');
            const weekStart = getWeekStartFromWeekNumber(year, week);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            const weekEntries = amazonHubData.entries.filter(e => {
                const entryDate = new Date(e.date);
                return entryDate >= weekStart && entryDate <= weekEnd;
            });
            
            // Group by driver and business
            const payouts = {};
            amazonHubData.drivers.forEach(driver => {
                payouts[driver] = {};
                amazonHubData.businesses.forEach(business => {
                    payouts[driver][business] = {
                        packages: 0,
                        amount: 0
                    };
                });
            });
            
            weekEntries.forEach(entry => {
                if (payouts[entry.driver] && payouts[entry.driver][entry.business]) {
                    payouts[entry.driver][entry.business].packages += entry.packages;
                    payouts[entry.driver][entry.business].amount += entry.driverPay;
                }
            });
            
            // Update table
            const tbody = document.getElementById('driverPayouts');
            let html = '';
            let driverTotals = {};
            
            Object.keys(payouts).forEach(driver => {
                driverTotals[driver] = 0;
                Object.keys(payouts[driver]).forEach(business => {
                    if (payouts[driver][business].packages > 0) {
                        html += `
                            <tr>
                                <td>${driver}</td>
                                <td>${business}</td>
                                <td>${payouts[driver][business].packages}</td>
                                <td>$${payouts[driver][business].amount.toFixed(2)}</td>
                                <td><span style="color: #f6ad55;">Pending</span></td>
                            </tr>
                        `;
                        driverTotals[driver] += payouts[driver][business].amount;
                    }
                });
            });
            
            tbody.innerHTML = html;
            
            // Update driver totals
            document.getElementById('gabrielTotal').textContent = `$${(driverTotals['Gabriel'] || 0).toFixed(2)}`;
            document.getElementById('rafaTotal').textContent = `$${(driverTotals['Rafa JR'] || 0).toFixed(2)}`;
            document.getElementById('jeurisTotal').textContent = `$${(driverTotals['Jeuris'] || 0).toFixed(2)}`;
            document.getElementById('jamelTotal').textContent = `$${(driverTotals['Jamel'] || 0).toFixed(2)}`;
        }

        // Update business summary
        function updateBusinessSummary() {
            const weekStart = getWeekStart(new Date());
            const weekEntries = amazonHubData.entries.filter(e => {
                const entryDate = new Date(e.date);
                return entryDate >= weekStart;
            });
            
            // Calculate by business
            const businessStats = {};
            amazonHubData.businesses.forEach(business => {
                businessStats[business] = {
                    packages: 0,
                    amazonRevenue: 0,
                    driverCosts: 0,
                    profit: 0
                };
            });
            
            weekEntries.forEach(entry => {
                if (businessStats[entry.business]) {
                    businessStats[entry.business].packages += entry.packages;
                    businessStats[entry.business].amazonRevenue += entry.amazonPay;
                    businessStats[entry.business].driverCosts += entry.driverPay;
                    businessStats[entry.business].profit += entry.profit;
                }
            });
            
            // Add HCP payment to Senor Bigote
            const hcpDaily = amazonHubData.settings.hcpWeekly / 7;
            const daysSinceWeekStart = Math.floor((new Date() - weekStart) / (1000 * 60 * 60 * 24)) + 1;
            const hcpSoFar = hcpDaily * Math.min(daysSinceWeekStart, 7);
            businessStats['Senor Bigote'].profit += hcpSoFar;
            
            // Update stat cards
            document.getElementById('sbProfit').textContent = `$${businessStats['Senor Bigote'].profit.toFixed(2)}`;
            document.getElementById('csProfit').textContent = `$${businessStats['Cana Stays'].profit.toFixed(2)}`;
            document.getElementById('r809Profit').textContent = `$${businessStats['809 Restaurant'].profit.toFixed(2)}`;
            document.getElementById('p101Profit').textContent = `$${businessStats['101 Pescaderia'].profit.toFixed(2)}`;
            
            // Update performance table
            const tbody = document.getElementById('businessPerformance');
            tbody.innerHTML = Object.keys(businessStats).map(business => {
                const stats = businessStats[business];
                const margin = stats.amazonRevenue > 0 ? (stats.profit / stats.amazonRevenue * 100) : 0;
                const extraNote = business === 'Senor Bigote' ? ' (incl. HCP)' : '';
                
                return `
                    <tr>
                        <td>${business}${extraNote}</td>
                        <td>${stats.packages}</td>
                        <td>$${stats.amazonRevenue.toFixed(2)}</td>
                        <td>$${stats.driverCosts.toFixed(2)}</td>
                        <td>$${stats.profit.toFixed(2)}</td>
                        <td>${margin.toFixed(1)}%</td>
                    </tr>
                `;
            }).join('');
        }

        // Delete entry
        function deleteEntry(id) {
            if (confirm('Are you sure you want to delete this entry?')) {
                amazonHubData.entries = amazonHubData.entries.filter(e => e.id !== id);
                saveData();
                updateAllDisplays();
            }
        }

        // Add new driver
        function addDriver() {
            const name = document.getElementById('newDriverName').value.trim();
            if (!name) {
                alert('Please enter a driver name');
                return;
            }
            
            if (amazonHubData.drivers.includes(name)) {
                alert('Driver already exists');
                return;
            }
            
            amazonHubData.drivers.push(name);
            saveData();
            
            // Update dropdowns
            const select = document.getElementById('entryDriver');
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            select.appendChild(option);
            
            document.getElementById('newDriverName').value = '';
            alert(`Driver "${name}" added successfully!`);
        }

        // Add new business
        function addBusiness() {
            const name = document.getElementById('newBusinessName').value.trim();
            if (!name) {
                alert('Please enter a business name');
                return;
            }
            
            if (amazonHubData.businesses.includes(name)) {
                alert('Business already exists');
                return;
            }
            
            amazonHubData.businesses.push(name);
            saveData();
            
            // Update dropdowns
            const select = document.getElementById('entryBusiness');
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            select.appendChild(option);
            
            document.getElementById('newBusinessName').value = '';
            alert(`Business "${name}" added successfully!`);
        }

        // Export data to CSV
        function exportPayouts() {
            const weekValue = document.getElementById('payoutWeek').value;
            if (!weekValue) {
                alert('Please select a week first');
                return;
            }
            
            let csv = 'Driver,Business,Packages,Amount\n';
            
            const rows = document.querySelectorAll('#driverPayouts tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length >= 4) {
                    csv += `${cells[0].textContent},${cells[1].textContent},${cells[2].textContent},${cells[3].textContent}\n`;
                }
            });
            
            downloadCSV(csv, `payouts-${weekValue}.csv`);
        }

        // Export all data
        function exportAllData() {
            let csv = 'Date,Driver,Business,Packages,Amazon Pay,Driver Pay,Profit\n';
            
            amazonHubData.entries.forEach(entry => {
                csv += `${entry.date},${entry.driver},${entry.business},${entry.packages},${entry.amazonPay.toFixed(2)},${entry.driverPay.toFixed(2)},${entry.profit.toFixed(2)}\n`;
            });
            
            downloadCSV(csv, `amazon-hub-data-${new Date().toISOString().split('T')[0]}.csv`);
        }

        // Download CSV helper
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('href', url);
            a.setAttribute('download', filename);
            a.click();
        }

        // Helper functions
        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day;
            return new Date(d.setDate(diff));
        }

        function getWeekStartFromWeekNumber(year, week) {
            const simple = new Date(year, 0, 1 + (week - 1) * 7);
            const dow = simple.getDay();
            const ISOweekStart = simple;
            if (dow <= 4)
                ISOweekStart.setDate(simple.getDate() - simple.getDay());
            else
                ISOweekStart.setDate(simple.getDate() + 7 - simple.getDay());
            return ISOweekStart;
        }

        // Update all displays
        function updateAllDisplays() {
            updateDashboard();
            updatePayouts();
            updateBusinessSummary();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
            
            // Set current week
            const now = new Date();
            const year = now.getFullYear();
            const weekNum = getWeekNumber(now);
            document.getElementById('payoutWeek').value = `${year}-W${weekNum.toString().padStart(2, '0')}`;
            
            // Add event listener for package input
            document.getElementById('entryPackages').addEventListener('input', updatePreview);
            document.getElementById('entryBusiness').addEventListener('change', updatePreview);
            
            // Load saved data
            loadData();
        });

        function getWeekNumber(d) {
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
            const weekNo = Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7);
            return weekNo;
        }

        // Mark all as paid
        function markAllPaid() {
            if (confirm('Mark all current week payments as paid?')) {
                alert('Payments marked as paid successfully!');
                // In a real app, this would update payment status in the database
            }
        }

        // Generate report
        function generateReport() {
            const type = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            if (!startDate || !endDate) {
                alert('Please select date range');
                return;
            }
            
            const reportContent = document.getElementById('reportContent');
            reportContent.style.display = 'block';
            
            // Filter entries by date range
            const reportEntries = amazonHubData.entries.filter(e => {
                return e.date >= startDate && e.date <= endDate;
            });
            
            const totalPackages = reportEntries.reduce((sum, e) => sum + e.packages, 0);
            const totalRevenue = reportEntries.reduce((sum, e) => sum + e.amazonPay, 0);
            const totalCosts = reportEntries.reduce((sum, e) => sum + e.driverPay, 0);
            const totalProfit = reportEntries.reduce((sum, e) => sum + e.profit, 0);
            
            reportContent.innerHTML = `
                <h3>Report: ${type.charAt(0).toUpperCase() + type.slice(1)} Summary</h3>
                <p>Period: ${startDate} to ${endDate}</p>
                <div class="summary-grid">
                    <div class="summary-item">
                        <h4>Total Packages</h4>
                        <div class="amount">${totalPackages}</div>
                    </div>
                    <div class="summary-item">
                        <h4>Total Revenue</h4>
                        <div class="amount">$${totalRevenue.toFixed(2)}</div>
                    </div>
                    <div class="summary-item">
                        <h4>Total Driver Costs</h4>
                        <div class="amount">$${totalCosts.toFixed(2)}</div>
                    </div>
                    <div class="summary-item">
                        <h4>Net Profit</h4>
                        <div class="amount">$${totalProfit.toFixed(2)}</div>
                    </div>
                </div>
            `;
        }

        // Import data (placeholder)
        function importData() {
            alert('Import feature: You can upload a CSV file with your historical data. This feature will be implemented based on your specific needs.');
        }
    </script>
</body>
</html>